(function(a){"use strict",window.elFinder=function(b,c){this.time("load");var d=this,b=a(b),e=a("<div/>").append(b.contents()),f=b.attr("style"),g=b.attr("id")||"",h="elfinder-"+(g||Math.random().toString().substr(2,7)),i="mousedown."+h,j="keydown."+h,k="keypress."+h,l=!0,m=!0,n=["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","dragstart","dragstop"],o={},p="",q={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:!0,tmb:!1},r={},s=[],t={},u={},v=[],w=[],x=new d.command(d),y=this.options.width||"auto",z=parseInt(this.options.height)||300,A=a(document.createElement("audio")).hide().appendTo("body")[0],B=function(a){if(a.init)r={};else for(var b in r)r.hasOwnProperty(b)&&r[b].mime!="directory"&&r[b].phash==p&&delete r[b];p=a.cwd.hash,C(a.files),r[p]||(d.log("no cwd in cache"),C([a.cwd])),d.lastDir(p)},C=function(a){var b=a.length,c;while(b--)c=a[b],c.name&&c.hash&&c.mime&&(r[c.hash]=c)},D=function(b){var c=b.keyCode,e=b.ctrlKey||b.metaKey;l&&(a.each(u,function(a,f){f.type==b.type&&f.keyCode==c&&f.shiftKey==b.shiftKey&&f.ctrlKey==e&&f.altKey==b.altKey&&(b.preventDefault(),b.stopPropagation(),f.callback(b,d),d.debug("shortcut-exec",a+" : "+f.description))}),c==9&&b.preventDefault())};this.api=null,this.newAPI=!1,this.oldAPI=!1,this.OS=navigator.userAgent.indexOf("Mac")!==-1?"mac":navigator.userAgent.indexOf("Win")!==-1?"win":"other",this.options=a.extend({},this.options,c||{}),this.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+(this.direction=="rtl"?"rtl":"ltr")+" "+this.options.cssClass,this.requestType=/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get",this.customData=a.isPlainObject(this.options.customData)?this.options.customData:{},this.id=g,this.namespace=h,this.lang=this.i18[this.options.lang]&&this.i18[this.options.lang].messages?this.options.lang:"en",this.direction=this.i18[this.lang].direction,this.messages=this.i18[this.lang].messages,this.storage=function(){try{return"localStorage"in window&&window.localStorage!==null?d.localStorage:d.cookie}catch(a){return d.cookie}}(),this.sort=d.sorts[d.options.sort]||1,this.notifyDelay=this.options.notifyDelay>0?parseInt(this.options.notifyDelay):500,this.draggable={appendTo:"body",addClasses:!0,delay:30,revert:!0,refreshPositions:!0,cursor:"move",cursorAt:{left:50,top:47},drag:function(a,b){b.helper.toggleClass("elfinder-drag-helper-plus",a.shiftKey||a.ctrlKey||a.metaKey)},stop:function(){d.trigger("focus").trigger("dragstop")},helper:function(b,c){var e=this.id?a(this):a(this).parents("[id]:first"),f=a('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-plus"/></div>'),g=function(a){return'<div class="elfinder-cwd-icon '+d.mime2class(a)+' ui-corner-all"/>'},h,i;d.trigger("dragstart",{target:e[0],originalEvent:b}),h=e.is("."+d.res("class","cwdfile"))?d.selected():[d.navId2Hash(e.attr("id"))],f.append(g(r[h[0]].mime)).data("files",h),(i=h.length)>1&&f.append(g(r[h[i-1]].mime)+'<span class="elfinder-drag-num">'+i+"</span>");return f}},this.droppable={tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file",hoverClass:this.res("class","adroppable"),drop:function(b,c){var e=a(this),f=a.map(c.helper.data("files")||[],function(a){return a||null}),g=[],h="class",i,j,k,l;e.is("."+d.res(h,"cwd"))?j=p:e.is("."+d.res(h,"cwdfile"))?j=e.attr("id"):e.is("."+d.res(h,"navdir"))&&(j=d.navId2Hash(e.attr("id"))),i=f.length;while(i--)l=f[i],l!=j&&r[l].phash!=j&&g.push(l);g.length&&(c.helper.hide(),d.clipboard(g,!(b.ctrlKey||b.shiftKey||b.metaKey)),d.exec("paste",j).always(function(){d.clipboard([])}),d.trigger("drop",{files:f}))}},this.enabled=function(){return b.is(":visible")&&l},this.visible=function(){return b.is(":visible")},this.root=function(a){var b=r[a||p],c;while(b&&b.phash)b=r[b.phash];if(b)return b.hash;while(c in r&&r.hasOwnProperty(c)){b=r[c];if(!b.phash&&!b.mime=="directory"&&b.read)return b.hash}return""},this.cwd=function(){return r[p]||{}},this.option=function(a){return q[a]||""},this.file=function(a){return r[a]},this.files=function(){return a.extend(!0,{},r)},this.parents=function(a){var b=[],c;while(c=this.file(a))b.unshift(c.hash),a=c.phash;return b},this.path=function(a){var b=r[a];return b.path?b.path:b?q.path+(b.hash==p?"":q.separator+b.name):""},this.url=function(a){var b=r[a],c="";if(b.url)return b.url;if(q.url&&(c=this.path(a))){c=c.replace(q.separator,"/");return q.url+c.substr(c.indexOf("/")+1)}return""},this.tmb=function(b){var c=r[b],d=c&&c.tmb&&c.tmb!=1?q.tmbUrl+c.tmb:"";d&&(a.browser.opera||a.browser.msie)&&(d+="?_="+(new Date).getTime());return d},this.selected=function(){return s.slice(0)},this.selectedFiles=function(){return a.map(s,function(a){return r[a]||null})},this.fileByName=function(a,b){var c;for(c in r)if(r.hasOwnProperty(c)&&r[c].phash==b&&r[c].name==a)return r[c]},this.validResponse=function(a,b){return this.rules[this.rules[a]?a:"defaults"](b)},this.request=function(b){var c=this,d=this.options,e=this.errors(),f=a.Deferred(),g=a.extend({},d.customData,{mimes:d.onlyMimes},b.data||b),h=g.cmd,i=!b.preventDefault&&!b.preventFail,j=!b.preventDefault&&!b.preventDone,k=a.extend({},b.notify),l=!!b.raw,m=b.syncOnFail,n,b=a.extend({url:d.url,async:!0,type:this.requestType,dataType:"json",cache:!1,data:g},b.options||{}),o=function(b){b.warning&&c.error(b.warning),h=="open"&&B(a.extend(!0,{},b)),b.removed&&b.removed.length&&c.remove(b),b.added&&b.added.length&&c.add(b),b.changed&&b.changed.length&&c.change(b),c.trigger(h,b)},p=function(a,b){var c;switch(b){case"abort":c=a.quiet?"":[e.connect,e.abort];break;case"timeout":c=[e.connect,e.timeout];break;case"parsererror":c=[e.response,e.json];break;default:a.status==403?c=[e.connect,e.access]:a.status==404?c=[e.connect,e.notfound]:c=e.connect}f.reject(c,a,b)},r=function(b){if(l)return f.resolve(b);if(!b)return f.reject([e.response,e.empty],s);if(!a.isPlainObject(b))return f.reject([e.response,e.json],s);if(b.error)return f.reject(b.error,s);if(!c.validResponse(h,b))return f.reject(e.response,s);b=c.normalize(b),c.api||(c.api=b.api||1,c.newAPI=c.api>=2,c.oldAPI=!c.newAPI),b.options&&(q=a.extend({},q,b.options)),f.resolve(b),b.debug&&c.debug("backend-debug",b.debug)},s,t;j&&f.done(o),f.fail(function(a){a&&(i?c.error(a):c.debug("error",c.i18n(a)))});if(!h)return f.reject(e.cmdRequired);m&&f.fail(function(a){a&&c.sync()}),k.type&&k.cnt&&(n=setTimeout(function(){c.notify(k),f.always(function(){k.cnt=-(parseInt(k.cnt)||0),c.notify(k)})},c.notifyDelay),f.always(function(){clearTimeout(n)}));if(h=="open")while(t=w.pop())!t.isRejected()&&!t.isResolved()&&(t.quiet=!0,t.abort());delete b.preventFail,s=this.transport.send(b).fail(p).done(r),h=="open"&&(w.unshift(s),f.always(function(){var b=a.inArray(s,w);b!==-1&&w.splice(b,1)}));return f},this.diff=function(b){var c={},d=[],e=[],f=[],g=function(a){var b=f.length;while(b--)if(f[b].hash==a)return!0};a.each(b,function(a,b){c[b.hash]=b}),a.each(r,function(a,b){!c[a]&&e.push(a)}),a.each(c,function(b,c){var e=r[b];e?a.each(c,function(a){if(c[a]!=e[a]){f.push(c);return!1}}):d.push(c)}),a.each(e,function(b,d){var h=r[d],i=h.phash;i&&h.mime=="directory"&&a.inArray(i,e)===-1&&c[i]&&!g(i)&&f.push(c[i])});return{added:d,removed:e,changed:f}},this.sync=function(){var b=this,c=a.Deferred().done(function(){b.trigger("sync")}),d={data:{cmd:"open",init:1,target:p,tree:this.ui.tree?1:0},preventDefault:!0},e={data:{cmd:"parents",target:p},preventDefault:!0};a.when(this.request(d),this.request(e)).fail(function(a){c.reject(a),a&&b.request({data:{cmd:"open",target:b.lastDir(""),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}})}).done(function(a,d){var e=b.diff(a.files.concat(d&&d.tree?d.tree:[]));e.removed.length&&b.remove(e),e.added.length&&b.add(e),e.changed.length&&b.change(e);return c.resolve(e)});return c},this.upload=function(a){return this.transport.upload(a,this)},this.bind=function(a,b){var c;if(typeof b=="function"){a=(""+a).toLowerCase().split(/\s+/);for(c=0;c<a.length;c++)t[a[c]]===void 0&&(t[a[c]]=[]),t[a[c]].push(b)}return this},this.unbind=function(a,b){var c=t[(""+a).toLowerCase()]||[],d=c.indexOf(b);d>-1&&c.splice(d,1),b=null;return this},this.trigger=function(b,c){var b=b.toLowerCase(),d=t[b]||[],e,f;this.debug("event-"+b,c);if(d.length){b=a.Event(b);for(e=0;e<d.length;e++){b.data=a.extend(!0,{},c);try{if(d[e](b,this)===!1||b.isDefaultPrevented()){this.debug("event-stoped",b.type);break}}catch(g){window.console&&window.console.log&&window.console.log(g)}}}return this},this.shortcut=function(b){var c,d,e,f,g;if(this.options.allowShortcuts&&b.pattern&&a.isFunction(b.callback)){c=b.pattern.toUpperCase().split(/\s+/);for(f=0;f<c.length;f++)d=c[f],g=d.split("+"),e=(e=g.pop()).length==1?e>0?e:e.charCodeAt(0):a.ui.keyCode[e],e&&!u[d]&&(u[d]={keyCode:e,altKey:a.inArray("ALT",g)!=-1,ctrlKey:a.inArray("CTRL",g)!=-1,shiftKey:a.inArray("SHIFT",g)!=-1,type:b.type||"keydown",callback:b.callback,description:b.description,pattern:d})}return this},this.shortcuts=function(){var b=[];a.each(u,function(a,c){b.push([c.pattern,d.i18n(c.description)])});return b},this.clipboard=function(b,c){var d=function(){return a.map(v,function(a){return a.hash})};b!==void 0&&(v.length&&this.trigger("unlockfiles",{files:d()}),v=a.map(b||[],function(a){var b=r[a];if(b)return{hash:a,phash:b.phash,name:b.name,read:b.read,locked:b.locked,cut:!!c};return null}),this.trigger("changeclipboard",{clipboard:v.slice(0,v.length)}),c&&this.trigger("lockfiles",{files:d()}));return v.slice(0,v.length)},this.isCommandEnabled=function(b){return this._commands[b]?a.inArray(b,q.disabled)===-1:!1},this.exec=function(b,c,d){return this._commands[b]&&this.isCommandEnabled(b)?this._commands[b].exec(c,d):a.Deferred().reject("No such command")},this.dialog=function(c,d){return a("<div/>").append(c).appendTo(b).elfinderdialog(d)},this.getUI=function(a){return this.ui[a]||b},this.command=function(a){return a===void 0?this._commands:this._commands[a]},this.resize=function(a,c){b.css("width",a).height(c).trigger("resize")},this.restoreSize=function(){this.resize(y,z)},this.show=function(){b.show(),this.enable().trigger("show")},this.hide=function(){this.disable().trigger("hide"),b.hide()},this.destroy=function(){b&&b[0].elfinder&&(this.trigger("destroy").disable(),t={},u={},a(document).add(b).unbind("."+this.namespace),d.trigger=function(){},b.children().remove(),b.append(e.contents()).removeClass(this.cssClass).attr("style",f),b[0].elfinder=null)};if(!(a.fn.selectable&&a.fn.draggable&&a.fn.droppable))return alert(this.i18n(this.errmsg("jqui")));if(!b.length)return alert(this.i18n(this.errmsg("node")));if(!this.options.url)return alert(this.i18n(this.errmsg("url")));a.extend(a.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120}),this.dragUpload=!1,this.xhrUpload=typeof XMLHttpRequestUpload!="undefined"&&typeof File!="undefined"&&typeof FormData!="undefined",this.transport={},typeof this.options.transport=="object"&&(this.transport=this.options.transport,typeof this.transport.init=="function"&&this.transport.init(this)),typeof this.transport.send!="function"&&(this.transport.send=function(b){return a.ajax(b)}),this.transport.upload=="iframe"?this.transport.upload=a.proxy(this.uploads.iframe,this):typeof this.transport.upload=="function"?this.dragUpload=!!this.options.dragUpload:this.xhrUpload?(this.transport.upload=a.proxy(this.uploads.xhr,this),this.dragUpload=!0):this.transport.upload=a.proxy(this.uploads.iframe,this),this.error=function(){var a=arguments[0];return arguments.length==1&&typeof a=="function"?d.bind("error",a):d.trigger("error",{error:a})},a.each(["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","dragstart","dragstop","search","searchend","viewchange"],function(b,c){d[c]=function(){var b=arguments[0];return arguments.length==1&&typeof b=="function"?d.bind(c,b):d.trigger(c,a.isPlainObject(b)?b:{})}}),this.enable(function(){!l&&d.visible()&&d.ui.overlay.is(":hidden")&&(l=!0,a("texarea,input,button").blur())}).disable(function(){m=l,l=!1}).select(function(b){s=a.map(b.data.selected||b.data.value||[],function(a){return r[a]?a:null})}).error(function(b){var c={cssClass:"elfinder-dialog-error",title:d.i18n(d.res("msg","error")),resizable:!1,close:function(){a(this).elfinderdialog("destroy")},buttons:{}};c.buttons[d.i18n(d.res("msg","close"))]=function(){a(this).elfinderdialog("close")},d.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"/>'+d.i18n(b.data.error),c)}).bind("tree parents",function(a){C(a.data.tree||[])}).bind("tmb",function(b){a.each(b.data.images||[],function(a,b){r[a]&&(r[a].tmb=b)})}).add(function(a){C(a.data.added||[])}).change(function(b){a.each(b.data.changed||[],function(b,c){var d=c.hash;r[d]=r[d]?a.extend(r[d],c):c})}).remove(function(b){var c=b.data.removed||[],d=c.length,e=function(b){var c=r[b];c&&(c.mime=="directory"&&c.dirs&&a.each(r,function(a,c){c.phash==b&&e(a)}),delete r[b])};while(d--)e(c[d])}).bind("search",function(a){C(a.data.files)}).bind("rm",function(b){var c=A.canPlayType&&A.canPlayType('audio/wav; codecs="1"');c&&c!=""&&c!="no"&&a(A).html('<source src="./sounds/rm.wav" type="audio/wav">')[0].play()}),a.each(this.options.handlers,function(a,b){d.bind(a,b)}),this.history=new this.history(this),typeof this.options.getFileCallback=="function"&&this.commands.getfile&&(this.bind("dblclick",function(a){a.preventDefault(),d.exec("getfile").fail(function(){d.exec("open")})}),this.shortcut({pattern:"enter",description:this.res("name","getfile"),callback:function(){d.exec("getfile").fail(function(){d.exec(d.OS=="mac"?"rename":"open")})}}).shortcut({pattern:"ctrl+enter",description:this.res("name",this.OS=="mac"?"rename":"open"),callback:function(){d.exec(d.OS=="mac"?"rename":"open")}})),this._commands={},a.isArray(this.options.commands)||(this.options.commands=[]),a.each(["open","reload","back","forward","up","home","info","search","quicklook","getfile","help"],function(b,c){a.inArray(c,d.options.commands)===-1&&d.options.commands.push(c)}),a.each(this.options.commands,function(b,c){var e=d.commands[c];a.isFunction(e)&&!d._commands[c]&&(e.prototype=x,d._commands[c]=new e,d._commands[c].setup(c,d.options.commandsOptions[c]||{}))}),b.addClass(this.cssClass).bind(i,function(){!l&&d.enable()}),this.ui={workzone:a("<div/>").appendTo(b).elfinderworkzone(this),navbar:a("<div/>").appendTo(b).elfindernavbar(this),contextmenu:a("<div/>").appendTo(b).elfindercontextmenu(this),overlay:a("<div/>").appendTo(b).elfinderoverlay({show:function(){d.disable()},hide:function(){m&&d.enable()}}),cwd:a("<div/>").appendTo(b).elfindercwd(this),notify:this.dialog("",{cssClass:"elfinder-dialog-notify",position:{top:"12px",right:"12px"},resizable:!1,autoOpen:!1,title:"&nbsp;",width:280}),statusbar:a('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"/>').appendTo(b)},a.each(this.options.ui||[],function(c,e){var f="elfinder"+e,g=d.options.uiOptions[e]||{};!d.ui[e]&&a.fn[f]&&(d.ui[e]=a("<"+(g.tag||"div")+"/>").appendTo(b)[f](d,g))}),b[0].elfinder=this,this.options.resizable&&a.fn.resizable&&b.resizable({handles:"se",alsoResize:d.ui.workzone,minWidth:300,minHeight:200}),this.resize(y,z),a(document).bind("click."+this.namespace,function(c){l&&!a(c.target).closest(b).length&&d.disable()}).bind(j+" "+k,D),this.trigger("init").request({data:{cmd:"open",target:d.lastDir(),init:1,tree:this.ui.tree?1:0},preventDone:!0,notify:{type:"open",cnt:1,hideCnt:!0},freeze:!0}).fail(function(){d.trigger("fail").disable().lastDir(""),t={},u={},a(document).add(b).unbind("."+this.namespace),d.trigger=function(){}}).done(function(b){d.load().debug("api",d.api),b=a.extend(!0,{},b),B(b),d.trigger("open",b)}),this.one("load",function(){b.trigger("resize")}),d.timeEnd("load")},elFinder.prototype={res:function(a,b){return this.resources[a]&&this.resources[a][b]},errmsg:function(a){return this.resources.error&&this.resources.error[a]||""},errors:function(){return this.resources.error},i18:{en:{translator:"",language:"English",direction:"ltr",messages:{}}},kinds:{unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"Broken alias","application/x-empty":"Plain text","application/postscript":"Postscript document","application/octet-stream":"Application","application/x-executable":"Application","application/vnd.ms-office":"Microsoft Office document","application/vnd.ms-word":"Microsoft Word document","application/vnd.ms-excel":"Microsoft Excel document","application/vnd.ms-powerpoint":"Microsoft Powerpoint presentation","application/pdf":"Portable Document Format (PDF)","application/xml":"XML document","application/vnd.oasis.opendocument.text":"Open Office document","application/x-shockwave-flash":"Flash application","application/flash-video":"Flash video","application/x-bittorrent":"Bittorrent file","application/javascript":"Javascript source","application/rtf":"Rich Text Format (RTF)","application/x-gzip":"GZIP archive","application/x-bzip2":"BZIP archive","application/zip":"ZIP archive","application/x-rar":"RAR archive","application/x-tar":"TAR archive","application/x-7z-compressed":"7z archive","application/x-jar":"Java JAR file","text/plain":"Plain text","text/x-php":"PHP source","text/html":"HTML document","text/javascript":"Javascript source","text/css":"Cascading style sheet","text/rtf":"Rich Text Format","text/rtfd":"Rich Text Format","text/x-c":"C source","text/x-csrc":"C source","text/x-chdr":"C header source","text/x-c++":"C++ source","text/x-c++src":"C++ source","text/x-c++hdr":"C++ header source","text/x-shellscript":"Unix shell script","text/x-python":"Python source","text/x-java":"Java source","text/x-java-source":"Java source","text/x-ruby":"Ruby source","text/x-perl":"Perl script","text/x-sql":"SQL source","text/xml":"XML document","text/x-comma-separated-values":"Comma separated values","image/x-ms-bmp":"BMP image","image/jpeg":"JPEG image","image/gif":"GIF image","image/png":"PNG image","image/tiff":"TIFF image","image/x-targa":"TGA image","image/vnd.adobe.photoshop":"Adobe Photoshop image","image/xbm":"X bitmap image","audio/mpeg":"MPEG audio","audio/midi":"MIDI audio","audio/ogg":"Ogg Vorbis audio","audio/mp4":"MPEG-4 audio","audio/x-m4a":"MPEG-4 audio","audio/wav":"WAV audio","video/x-dv":"DV movie","video/mp4":"MPEG-4 movie","video/mpeg":"MPEG movie","video/x-msvideo":"AVI movie","video/quicktime":"Quick Time movie","video/x-ms-wmv":"Windows Media Movie","video/x-flv":"Flash movie","video/x-matroska":"Matroska movie","video/ogg":"Ogg movie"},rules:{defaults:function(b){if(!b||b.added&&!a.isArray(b.added)||b.removed&&!a.isArray(b.removed)||b.changed&&!a.isArray(b.changed))return!1;return!0},open:function(b){return b&&b.cwd&&b.files&&a.isPlainObject(b.cwd)&&a.isArray(b.files)},tree:function(b){return b&&b.tree&&a.isArray(b.tree)},parents:function(b){return b&&b.tree&&a.isArray(b.tree)},tmb:function(b){return b&&b.images&&(a.isPlainObject(b.images)||a.isArray(b.images))},upload:function(b){return b&&(a.isPlainObject(b.added)||a.isArray(b.added))},search:function(b){return b&&b.files&&a.isArray(b.files)}},sorts:{nameDirsFirst:1,kindDirsFirst:2,sizeDirsFirst:3,name:4,kind:5,size:6},commands:{},parseUploadData:function(b){var c=this.errors(),d;if(!a.trim(b))return{error:[c.response,c.empty]};try{d=a.parseJSON(b)}catch(e){return{error:[c.response,c.json]}}if(!this.validResponse("upload",d))return{error:[c.response]};d=this.normalize(d),d.removed=a.map(d.added||[],function(a){return a.hash});if(this.newAPI)return d},iframeCnt:0,uploads:{iframe:function(b){var c=this,d=b.input,e=this.errors(),f=a.Deferred().fail(function(a){a&&c.error(a)}).done(function(a){a.warning&&c.error(a.warning),a.removed&&c.remove(a),a.added&&c.add(a),a.changed&&c.change(a),c.trigger("upload",a)}),g="iframe-"+this.namespace+ ++this.iframeCnt,h=a('<form action="'+this.options.url+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="'+g+'"><input type="text" name="cmd" value="upload" /></form>'),i=a.browser.msie,j=function(){o&&clearTimeout(o),n&&clearTimeout(n),m&&c.notify({type:"upload",cnt:-l}),setTimeout(function(){i&&a('<iframe src="javascript:false;"/>').appendTo(h),h.remove(),k.remove()},100)},k=a('<iframe src="'+(i?"javascript:false;":"about:blank")+'" name="'+g+'" />').bind("load",function(){k.unbind("load").bind("load",function(){var a=c.parseUploadData(k.contents().text());j(),a.error?f.reject(a.error):f.resolve(a)}),n=setTimeout(function(){m=!0,c.notify({type:"upload",cnt:l})},c.options.notifyDelay),c.options.iframeTimeout>0&&(o=setTimeout(function(){j(),f.reject([e.connect,e.timeout])},c.options.iframeTimeout)),h.submit()}),l,m,n,o;if(d&&a(d).is(":file")&&a(d).val())h.append(d);else return f.reject();l=d.files?d.files.length:1,h.append('<input type="hidden" name="'+(this.newAPI?"target":"current")+'" value="'+this.cwd().hash+'"/>').append('<input type="hidden" name="html" value="1"/>').append(a(d).attr("name","upload[]")),a.each(this.options.onlyMimes||[],function(a,b){h.append('<input type="hidden" name="mimes[]" value="'+b+'"/>')}),a.each(this.options.customData,function(a,b){h.append('<input type="hidden" name="'+a+'" value="'+b+'"/>')}),h.appendTo("body"),k.appendTo("body");return f},xhr:function(b){var c=this,d=this.errors(),e=a.Deferred().fail(function(a){a&&c.error(a)}).done(function(a){a.warning&&c.error(a.warning),a.removed&&c.remove(a),a.added&&c.add(a),a.changed&&c.change(a),c.trigger("upload",a)}).always(function(){m&&clearTimeout(m),k&&c.notify({type:"upload",cnt:-i,progress:100*i})}),f=new XMLHttpRequest,g=new FormData,h=b.input?b.input.files:b.files,i=h.length,j=5,k=!1,l=function(){return setTimeout(function(){k=!0,c.notify({type:"upload",cnt:i,progress:j*i})},c.options.notifyDelay)},m;if(!i)return e.reject();f.addEventListener("error",function(){e.reject(d.connect)},!1),f.addEventListener("abort",function(){e.reject([d.connect,d.abort])},!1),f.addEventListener("load",function(){var a=f.status,b;if(a>500)return e.reject(d.response);if(a!=200)return e.reject(d.connect);if(f.readyState!=4)return e.reject([d.connect,d.timeout]);if(!f.responseText)return e.reject([d.response,d.empty]);b=c.parseUploadData(f.responseText),b.error?e.reject(b.error):e.resolve(b)},!1),f.upload.addEventListener("progress",function(a){var b=j,d;a.lengthComputable&&(d=parseInt(a.loaded*100/a.total),d>0&&!m&&(m=l()),d-b>4&&(j=d,k&&c.notify({type:"upload",cnt:0,progress:(j-b)*i})))},!1),f.open("POST",this.options.url,!0),g.append("cmd","upload"),g.append(this.newAPI?"target":"current",this.cwd().hash),a.each(this.options.customData,function(a,b){g.append(a,b)}),a.each(this.options.onlyMimes,function(a,b){g.append("mimes["+a+"]",b)}),a.each(h,function(a,b){g.append("upload["+a+"]",b)}),f.onreadystatechange=function(){f.readyState==4&&f.status==0&&e.reject([d.connect,d.abort])},f.send(g);if(!a.browser.safari||!b.files)m=l();return e}},one:function(b,c){var d=this,e=a.proxy(c,function(a){setTimeout(function(){d.unbind(a.type,e)},3);return c.apply(this,arguments)});return this.bind(b,e)},localStorage:function(a,b){var c=window.localStorage;a="elfinder-"+a+this.id,b!==void 0&&c.setItem(a,b);return c.getItem(a)||""},cookie:function(b,c){var d,e,f,g;b="elfinder-"+b+this.id;if(c===void 0){if(document.cookie&&document.cookie!=""){f=document.cookie.split(";"),b+="=";for(g=0;g<f.length;g++){f[g]=a.trim(f[g]);if(f[g].substring(0,b.length)==b)return decodeURIComponent(f[g].substring(b.length))}}return""}e=a.extend({},this.options.cookie),c===null&&(c="",e.expires=-1),typeof e.expires=="number"&&(d=new Date,d.setTime(d.getTime()+e.expires*864e5),e.expires=d),document.cookie=b+"="+encodeURIComponent(c)+"; expires="+e.expires.toUTCString()+(e.path?"; path="+e.path:"")+(e.domain?"; domain="+e.domain:"")+(e.secure?"; secure":"");return c},lastDir:function(a){return this.storage("lastdir",a)},_node:a("<span/>"),escape:function(a){return this._node.text(a).html()},normalize:function(b){var c=function(a){if(a&&a.hash&&a.name&&a.mime){a.mime=="application/x-empty"&&(a.mime="text/plain");return a}return null};b.files&&(b.files=a.map(b.files,c)),b.tree&&(b.tree=a.map(b.tree,c)),b.added&&(b.added=a.map(b.added,c)),b.changed&&(b.changed=a.map(b.changed,c)),b.api&&(b.init=!0);return b},compare:function(a,b){var c=a.mime,d=b.mime,e=c=="directory",f=d=="directory",g=a.name.toLowerCase(),h=b.name.toLowerCase(),i=e?0:a.size||0,j=f?0:b.size||0,k=this.sort;if(k<=3){if(e&&!f)return-1;if(!e&&f)return 1}if((k==2||k==5)&&c!=d)return c>d?1:-1;if((k==3||k==6)&&i!=j)return i>j?1:-1;return a.name.localeCompare(b.name)},sortFiles:function(b){return b.sort(a.proxy(this.compare,this))},notify:function(b){var c=b.type,d=this.i18n(this.res("notify",b.type)||"Doing something."),e=this.ui.notify,f=e.children(".elfinder-notify-"+c),g='<div class="elfinder-notify elfinder-notify-{type}"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"/><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"/><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"/></div></div>',h=b.cnt,i=b.progress>=0&&b.progress<=100?b.progress:0,j,k,l;if(!c)return this;f.length||(f=a(g.replace(/\{type\}/g,c).replace(/\{msg\}/g,d)).appendTo(e).data("cnt",0),i&&f.data({progress:0,total:0})),j=h+parseInt(f.data("cnt")),j>0?(!b.hideCnt&&f.children(".elfinder-notify-cnt").text("("+j+")"),e.is(":hidden")&&e.elfinderdialog("open"),f.data("cnt",j),i<100&&(k=f.data("total"))>=0&&(l=f.data("progress"))>=0&&(k=h+parseInt(f.data("total")),l=i+l,i=parseInt(l/k),f.data({progress:l,total:k}),e.find(".elfinder-notify-progress").animate({width:(i<100?i:100)+"%"},20))):(f.remove(),!e.children().length&&e.elfinderdialog("close"));return this},confirm:function(b){var c=!1,d={cssClass:"elfinder-dialog-confirm",modal:!0,resizable:!1,title:this.i18n(b.title||this.res("msg","confirmreq")),buttons:{},close:function(){!c&&b.cancel.callback(),a(this).elfinderdialog("destroy")}},e=this.i18n(this.res("msg","applyall")),f,g;b.reject&&(f=b.reject.label,d.buttons[this.i18n(this.res("msg",f)||f)]=function(){b.reject.callback(!!g&&!!g.prop("checked")),c=!0,a(this).elfinderdialog("close")}),f=b.accept.label,d.buttons[this.i18n(this.res("msg",f)||f)]=function(){b.accept.callback(!!g&&!!g.prop("checked")),c=!0,a(this).elfinderdialog("close")},f=b.cancel.label,d.buttons[this.i18n(this.res("msg",f)||f)]=function(){a(this).elfinderdialog("close")},b.all&&(b.reject&&(d.width=370),d.create=function(){g=a('<input type="checkbox" />'),a(this).next().children().before(a("<label>"+e+"</label>").prepend(g))},d.open=function(){var b=a(this).next(),c=parseInt(b.children(":first").outerWidth()+b.children(":last").outerWidth());c>parseInt(b.width())&&a(this).closest(".elfinder-dialog").width(c+30)});return this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"/>'+this.i18n(b.text),d)},validName:function(a){var b=this.options.validName;if(!a||typeof a!="string"||/^\.\.?$/.test(a)||a.indexOf(this.cwd().separator)!==-1)return!1;if(b){if(b instanceof RegExp)return b.test(a);if(typeof b=="function")return b(a)}return!0},uniqueName:function(a,b){var c=0,d="",e,f;a=this.i18n(a),b=b||this.cwd().hash,(e=a.indexOf(".txt"))!=-1&&(d=".txt",a=a.substr(0,e)),f=a+d;if(!this.fileByName(f,b))return f;while(c<1e4){f=a+" "+ ++c+d;if(!this.fileByName(f,b))return f}return a+Math.random()+d},i18n:function(){var b=this,c=this.messages,d=[],e=[],f=function(a){var c;if(a.indexOf("#")===0)if(c=b.file(a.substr(1)))return c.name;return a},g,h,i;for(g=0;g<arguments.length;g++){i=arguments[g];if(typeof i=="string")d.push(f(i));else if(a.isArray(i))for(h=0;h<i.length;h++)typeof i[h]=="string"&&d.push(f(i[h]))}for(g=0;g<d.length;g++){if(a.inArray(g,e)!==-1)continue;i=d[g],i=c[i]||i,i=i.replace(/\$(\d+)/g,function(a,b){b=g+parseInt(b),b>0&&d[b]&&e.push(b);return d[b]||""}),d[g]=i}return a.map(d,function(b,c){return a.inArray(c,e)===-1?b:null}).join("<br>")},mime2class:function(a){var b="elfinder-cwd-icon-";a=a.split("/");return b+a[0]+(a[0]!="image"&&a[1]?" "+b+a[1].replace(/(\.|\+)/g,"-"):"")},mime2kind:function(a){var b=typeof a=="object"?a.mime:a,c=this.kinds[b]||"unknown";a.alias?c="Alias":c=="unknown"&&(b.indexOf("text")===0?c="Text document":b.indexOf("image")===0?c="Image":b.indexOf("audio")===0?c="Audio media":b.indexOf("video")===0?c="Video media":b.indexOf("application")===0&&(c="Application"));return this.i18n(c)},formatDate:function(a){var b=this;return a=="unknown"?b.i18n(this.res("msg",a)):(""+a).replace(/([a-z]+)\s/i,function(a,c){return b.i18n(c)+" "})},perms2class:function(a){var b="";!a.read&&!a.write?b="elfinder-na":a.read?a.write||(b="elfinder-ro"):b="elfinder-wo";return b},formatPermissions:function(a){var b=[];a.read&&b.push(this.i18n("read")),a.write&&b.push(this.i18n("write"));return b.length?b.join(" "+this.i18n("and")+" "):this.i18n("no access")},formatSize:function(a){var b=1,c="bytes";a>1073741824?(b=1073741824,c="Gb"):a>1048576?(b=1048576,c="Mb"):a>1024&&(b=1024,c="Kb");return(a>0?Math.round(a/b):0)+" "+c},navHash2Id:function(a){return"nav-"+a},navId2Hash:function(a){return typeof a=="string"?a.substr(4):!1},log:function(a){window.console&&window.console.log&&window.console.log(a);return this},debug:function(b,c){var d=this.options.debug;(d=="all"||d===!0||a.isArray(d)&&a.inArray(b,d)!=-1)&&window.console&&window.console.log&&window.console.log("elfinder debug: ["+b+"] ["+this.id+"]",c);return this},time:function(a){window.console&&window.console.time&&window.console.time(a)},timeEnd:function(a){window.console&&window.console.timeEnd&&window.console.timeEnd(a)}},elFinder.prototype.version="2.0 beta",a.fn.elfinder=function(a){if(a=="instance")return this.getElFinder();return this.each(function(){var b=typeof a=="string"?a:"";this.elfinder||new elFinder(this,typeof a=="object"?a:{});switch(b){case"close":case"hide":this.elfinder.close();break;case"open":case"show":this.elfinder.open();break;case"destroy":this.elfinder.destroy()}})},a.fn.getElFinder=function(){var a;this.each(function(){if(this.elfinder){a=this.elfinder;return!1}});return a},elFinder.prototype.options={url:"",requestType:"get",transport:{},dragUploadAllow:"auto",iframeTimeout:0,customData:{token:"42",test:"test"},handlers:{},lang:"en",cssClass:"",commands:["open","reload","home","up","back","forward","getfile","quicklook","download","rm","duplicate","rename","mkdir","mkfile","upload","copy","cut","paste","edit","extract","archive","search","info","view","help"],commandsOptions:{getfile:{multiple:!1,folders:!1,oncomplete:""},upload:{ui:"uploadbutton"},quicklook:{autoplay:!0,jplayer:"extensions/jplayer"}},getFileCallback:null,ui:["toolbar","places","tree","path","stat"],uiOptions:{toolbar:[["back","forward"],["reload"],["home","up"],["mkdir","mkfile","upload"],["open","download","getfile"],["info"],["quicklook"],["copy","cut","paste"],["rm"],["duplicate","rename","edit"],["extract","archive"],["search"],["view"],["help"]],tree:{openRootOnLoad:!0,syncTree:!0}},onlyMimes:[],sort:"kindDirsFirst",width:"auto",height:415,resizable:!0,notifyDelay:500,allowShortcuts:!0,rememberLastDir:!0,showFiles:30,showThreshold:50,validName:!1,sync:1e3,loadTmbs:5,cookie:{expires:30,domain:"",path:"/",secure:!1},contextmenu:{navbar:["open","|","copy","cut","paste","duplicate","|","rm","|","info"],cwd:["reload","back","|","upload","mkdir","mkfile","paste","|","search","|","info"],files:["getfile","|","open","quicklook","|","download","|","edit","|","copy","cut","paste","duplicate","|","rm","|","archive","extract","|","info"]},debug:["error","warning","backend-debug","event-viewchange"]},elFinder.prototype.history=function(b){var c=this,d=!0,e=[],f,g=function(){e=[b.cwd().hash],f=0,d=!0},h=function(h){if(h&&c.canForward()||!h&&c.canBack()){d=!1;return b.exec("open",e[h?++f:--f]).fail(g)}return a.Deferred().reject()};this.canBack=function(){return f>0},this.canForward=function(){return f<e.length-1},this.back=h,this.forward=function(){return h(!0)},b.open(function(a){var c=e.length,g=b.cwd().hash;d&&(f>=0&&c>f+1&&e.splice(f+1),e[e.length-1]!=g&&e.push(g),f=e.length-1),d=!0}).reload(g)},elFinder.prototype.command=function(b){this.fm=b,this.name="",this.title="",this.state=-1,this.alwaysEnabled=!1,this._disabled=!1,this.disableOnSearch=!1,this.updateOnSelect=!0,this._handlers={enable:function(){this.update(void 0,this.value)},disable:function(){this.update(-1,this.value)},"open reload load":function(a){this._disabled=!this.alwaysEnabled&&!this.fm.isCommandEnabled(this.name),this.update(void 0,this.value),this.change()}},this.handlers={},this.shortcuts=[],this.options={ui:"button"},this.setup=function(b,c){var d=this,e=this.fm,f,g;this.name=b,this.title=e.i18n(e.res("name",b)||this.name),this.options=a.extend({},this.options,c),this.listeners=[],this.updateOnSelect&&(this._handlers.select=function(){this.update(void 0,this.value)}),a.each(a.extend({},d._handlers,d.handlers),function(b,c){e.bind(b,a.proxy(c,d))});for(f=0;f<this.shortcuts.length;f++)g=this.shortcuts[f],g.callback=a.proxy(g.callback||function(){this.exec()},this),!g.description&&(g.description=this.title),e.shortcut(g);this.disableOnSearch&&e.bind("search searchend",function(a){d._disabled=a.type=="search",d.update(void 0,d.value)}),this.init()},this.init=function(){},this.exec=function(b,c){return a.Deferred().reject()},this.disabled=function(){return this.state<0},this.enabled=function(){return this.state>-1},this.active=function(){return this.state>0},this.getstate=function(){return-1},this.update=function(a,b){var c=this.state,d=this.value;this._disabled?this.state=-1:this.state=a!==void 0?a:this.getstate(),this.value=b,(c!=this.state||d!=this.value)&&this.change()},this.change=function(a){var b,c;if(typeof a=="function")this.listeners.push(a);else for(c=0;c<this.listeners.length;c++){b=this.listeners[c];try{b(this.state,this.value)}catch(d){this.fm.debug("error",d)}}return this},this.hashes=function(c){return c?a.map(a.isArray(c)?c:[c],function(a){return b.file(a)?a:null}):b.selected()},this.files=function(b){var c=this.fm;return b?a.map(a.isArray(b)?b:[b],function(a){return c.file(a)||null}):c.selectedFiles()}},"use strict",elFinder.prototype.resources={"class":{hover:"ui-state-hover",active:"ui-state-active",disabled:"ui-state-disabled",draggable:"ui-draggable",droppable:"ui-droppable",adroppable:"elfinder-droppable-active",cwdfile:"elfinder-cwd-file",cwd:"elfinder-cwd",tree:"elfinder-tree",treeroot:"elfinder-navbar-root",navdir:"elfinder-navbar-dir",navdirwrap:"elfinder-navbar-dir-wrapper",navarrow:"elfinder-navbar-arrow",navsubtree:"elfinder-navbar-subtree",navcollapse:"elfinder-navbar-collapsed",navexpand:"elfinder-navbar-expanded",treedir:"elfinder-tree-dir",placedir:"elfinder-place-dir",searchbtn:"elfinder-button-search"},tpl:{perms:'<span class="elfinder-perms"/>',symlink:'<span class="elfinder-symlink"/>',navicon:'<span class="elfinder-nav-icon"/>',navspinner:'<span class="elfinder-navbar-spinner"/>',navdir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon"/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree"/></div>'},error:{unknown:"Unknown error.",jqui:"Invalid jQuery UI configuration. Check selectable, draggable and droppable components included.",node:"elFinder required DOM Element to be created.",url:"Invalid elFinder configuration! You have to set URL option.",access:"Access denied.",connect:"Unable to connect to backend.",abort:"Connection aborted.",timeout:"Connection timeout.",response:"Invalid backend response.",json:"Data is not JSON.",empty:"Data is empty.",nocmd:"Backend request required command name.",open:'Unable to open "$1".',notdir:"Object is not a folder.",notfile:"Object is not a file.",read:'Unable to read "$1".',write:'Unable to write into "$1".',denied:"Permission denied.",locked:'"$1" is locked and can not be renamed, moved or removed.',exists:'File named "$1" already exists in this location.',name:"Invalid file name.",notfound:"File not found.",popup:"Browser prevented opening popup window. To open file enable it in browser options.",copy:'Unable to copy "$1".',move:'Unable to move "$1".',copyinself:'Unable to copy "$1" into itself.',rm:'Unable to remove "$1".',extract:'Unable to extract files from "$1".',archive:"Unable to create archive.",notarchive:"File is not archive or has unsupported archive type.",cmdsupport:"Backend does not support this command."},name:{archive:"Create archive",back:"Back",copy:"Copy",cut:"Cut",download:"Download",duplicate:"Duplicate",edit:"Edit file",extract:"Extract files from archive",forward:"Forward",getfile:"Select files",help:"About this software",info:"Get info",mkdir:"New folder",mkfile:"New text file",open:"Open",paste:"Paste",quicklook:"Preview",reload:"Reload",rename:"Rename",rm:"Delete",search:"Find files",up:"Go to parent directory",upload:"Upload files",view:"View"},notify:{open:"Open folder",openfile:"Open file",reload:"Reload folder content",mkdir:"Creating directory",mkfile:"Creating files",rm:"Delete files",copy:"Copy files",move:"Move files",preparecopy:"Prepare to copy files",rename:"Rename files",upload:"Uploading files",download:"Downloading files",save:"Save files",archive:"Creating archive",extract:"Extracting files from archive",search:"Searching files"},confirm:{rm:"Are you shure you want to remove files?<br/>This cannot be undone!",repl:"Replace old file with new one?"},msg:{confirmreq:"Confirmation required",applyall:"Apply to all",cancel:"Cancel",move:"Move file",yes:"Yes",no:"No",error:"Error",close:"Close",searchres:"Search results",size:"Size",items:"Items",selitems:"selected items",unknown:"unknown",places:"Places",calc:"Calculating",aliasfor:"Alias for",path:"Path",dim:"Dimensions",modify:"Modified",perms:"Permissions",locked:"Locked",kind:"Kind",files:"Files",folders:"Folders",link:"Link",name:"Name"},mimes:{text:["application/x-empty","application/javascript","application/xhtml+xml","audio/x-mp3-playlist","application/x-bittorrent","application/x-web-config","application/docbook+xml","application/x-php","application/x-perl","application/x-awk","application/x-config","application/x-csh","application/xml"]},mixin:{make:function(){var b=this.fm,c=this.name,d=b.getUI("cwd"),e=b.errors(),f=a.Deferred().fail(function(a){a&&b.error(a)}).always(function(){l.remove(),k.remove(),b.enable()}),g="tmp_"+parseInt(Math.random()*1e5),h=b.cwd().hash,i=new Date,j={hash:g,name:b.uniqueName(this.prefix),mime:this.mime,read:!0,write:!0,date:"Today "+i.getHours()+":"+i.getMinutes()},k=d.trigger("create."+b.namespace,j).find("#"+g),l=a('<input type="text"/>').keydown(function(b){b.stopImmediatePropagation(),b.keyCode==a.ui.keyCode.ESCAPE?f.reject():b.keyCode==a.ui.keyCode.ENTER&&l.blur()}).mousedown(function(a){a.stopPropagation()}).blur(function(){var d=a.trim(l.val()),i=l.parent();if(i.length){if(!d)return f.reject(e.name);if(b.fileByName(d,h))return f.reject([e.exists,d]);i.html(b.escape(d)),b.lockfiles({files:[g]}),b.request({data:{cmd:c,name:d,target:h},notify:{type:c,cnt:1},preventFail:!0,syncOnFail:!0}).fail(function(a){f.reject(a)}).done(function(a){f.resolve(a)})}});if(!k.length)return f.reject();b.disable(),k.find(".elfinder-cwd-filename").empty("").append(l.val(j.name)),l.select().focus();return f}}},"use strict",a.fn.elfinderbutton=function(b){return this.each(function(){var c="class",d=b.fm,e=d.res(c,"disabled"),f=d.res(c,"active"),g=d.res(c,"hover"),h="elfinder-button-menu-item",i,j=a(this).addClass("ui-state-default elfinder-button").attr("title",b.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+b.name+'"/>').hover(function(a){!j.is("."+e)&&j.toggleClass(g)}).click(function(a){j.is("."+e)||(i&&b.variants.length>1?(i.is(":hidden")&&b.fm.getUI().click(),a.stopPropagation(),i.slideToggle(100)):b.exec())}),k=function(){i.hide()};a.isArray(b.variants)&&(j.addClass("elfinder-menubutton"),i=a('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(j).zIndex(10+j.zIndex()).delegate("."+h,"hover",function(){a(this).toggleClass(g)}).delegate("."+h,"click",function(c){c.preventDefault(),b.exec(b.fm.selected(),a(this).data("value"))}),b.fm.bind("disable select",k).getUI().click(k),b.change(function(){i.html(""),a.each(b.variants,function(b,c){i.append(a('<div class="'+h+'">'+c[1]+"</div>").data("value",c[0]))})})),b.change(function(){b.disabled()?j.removeClass(f).addClass(e):(j.removeClass(e),j[b.active()?"addClass":"removeClass"](f))}).change()})},"use strict",a.fn.elfindercontextmenu=function(b){return this.each(function(){var c=a.browser.opera?"click":"contextmenu",d="class",e="elfinder-contextmenu-item",f="elfinder-contextmenu-group",g="elfinder-contextmenu-sub",h=b.res(d,"hover"),i=b.res(d,"disabled"),j=b.res(d,"cwdfile"),k=b.res(d,"treedir"),l=b.res(d,"navdirwrap"),m=b.direction=="ltr"?"left":"right",n=a(this).addClass("ui-helper-reset ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-"+b.direction).hide().appendTo("body").delegate("."+e,"hover",function(){var b=a(this).toggleClass(h);b.is("."+f)&&b.children("."+g).toggle()}).delegate("."+e,"click",function(c){var d=a(this),e=d.data();c.preventDefault(),c.stopPropagation(),d.is("."+f)||(e&&e.cmd&&b.exec(e.cmd,n.data("targets"),e.variant,!0),q())}),o=a.extend({navbar:[],cwd:[]},b.options.contextmenu),p=function(c,d){var h=o[c],i=!1;n.text("").data("targets",d),a.each(h,function(c,h){var j=b.command(h),k,l;if(!j||!j.name)h=="|"&&i&&(n.append('<div class="elfinder-contextmenu-separator"/>'),i=!1);else{if(j.getstate(d)==-1)return;k=a('<div class="'+e+'"><span class="elfinder-button-icon elfinder-button-icon-'+j.name+' elfinder-contextmenu-icon"/><span>'+j.title+"</span></div>").data({cmd:j.name}),j.variants&&(l=a('<div class="ui-corner-all '+g+'"/>').appendTo(k.addClass(f).append('<span class="ui-icon ui-icon-triangle-1-e"/>')),a.each(j.variants,function(b,c){l.append(a('<div class="'+e+'"><span>'+c[1]+"</span></div>").data({cmd:j.name,variant:c[0]}))})),n.append(k),i=!0}})},q=function(){n.hide().text("").removeData("targets")},r=function(c,d){var e=a(window),f=n.outerWidth(),h=n.outerHeight(),i=e.width(),j=e.height(),k=e.scrollTop(),l=e.scrollLeft(),o={top:(d+h<j?d:d-h>0?d-h:d)+k,left:(c+f<i?c:c-f)+l,"z-index":100+b.getUI("workzone").zIndex()};!n.children().length||(n.css(o).show(),o={"z-index":o["z-index"]+10},o[m]=parseInt(n.width()),n.find("."+g).css(o))},s,t;b.one("load",function(){s=b.getUI("cwd").bind(c,function(c){var d=a(c.target),e=d.closest("."+j),f=[],g="files";c.preventDefault();if(e.length){if(e.is("."+i))return;s.trigger("selectfile",e.attr("id")),f=b.selected()}else s.trigger("unselectall"),f.push(b.cwd().hash),g="cwd";p(g,f),r(c.clientX,c.clientY)}),b.getUI("navbar").bind(c,function(c){var d=a(c.target),e=[];c.preventDefault(),d.is("."+k+",."+l)&&(d.is("."+l)&&(d=d.children("."+k)),d.length&&(e.push(b.navId2Hash(d.attr("id"))),p("navbar",e),r(c.clientX,c.clientY)))}),b.bind("disable select",q).getUI().click(q)}).one("destroy",function(){n.remove()})})},"use strict",a.fn.elfindercwd=function(b){this.not(".elfinder-cwd").each(function(){var c=b.storage("view")=="list",d="undefined",e="select."+b.namespace,f="unselect."+b.namespace,g="disable."+b.namespace,h="enable."+b.namespace,i="class",j=b.res(i,"cwdfile"),k="."+j,l="ui-selected",m=b.res(i,"disabled"),n=b.res(i,"draggable"),o=b.res(i,"droppable"),p=b.res(i,"hover"),q=b.res(i,"adroppable"),r=j+"-tmp",s=b.options.loadTmbs>0?b.options.loadTmbs:5,t={icon:'<div id="{hash}" class="'+j+' {permsclass} {dirclass} ui-corner-all"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on" {style}/>{marker}</div><div class="elfinder-cwd-filename" title="{name}">{name}</div></div>',row:'<tr id="{hash}" class="'+j+' {permsclass} {dirclass}"><td><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"/>{marker}<span class="elfinder-cwd-filename">{name}</span></div></td><td>{perms}</td><td>{date}</td><td>{size}</td><td>{kind}</td></tr>'},u=b.res("tpl","perms"),v=b.res("tpl","symlink"),w={permsclass:function(a){return b.perms2class(a)},perms:function(a){return b.formatPermissions(a)},dirclass:function(a){return a.mime=="directory"?"directory":""},mime:function(a){return b.mime2class(a.mime)},size:function(a){return b.formatSize(a.size)},date:function(a){return b.formatDate(a.date)},kind:function(a){return b.mime2kind(a)},marker:function(a){return(a.alias||a.mime=="symlink-broken"?v:"")+(!a.read||!a.write?u:"")}},x=function(a){a.name=b.escape(a.name);return t[c?"row":"icon"].replace(/\{([a-z]+)\}/g,function(b,c){return w[c]?w[c](a):a[c]?a[c]:""})},y=!1,z=function(b,d){function r(a,b){return a[b+"All"]("[id]:not(."+m+"):first")}var g=a.ui.keyCode,h=b==g.LEFT||b==g.UP,i=R.find("[id]."+l),j=h?"first":"last",k,n,o,p,q;if(i.length){k=i.filter(h?":first":":last"),o=r(k,h?"prev":"next");if(!o.length)n=k;else if(c||b==g.LEFT||b==g.RIGHT)n=o;else{p=k.position().top,q=k.position().left,n=k;if(h){do n=n.prev("[id]");while(n.length&&!(n.position().top<p&&n.position().left<=q));n.is("."+m)&&(n=r(n,"next"))}else{do n=n.next("[id]");while(n.length&&!(n.position().top>p&&n.position().left>=q));n.is("."+m)&&(n=r(n,"prev")),n.length||(o=R.find("[id]:not(."+m+"):last"),o.position().top>p&&(n=o))}}}else n=R.find("[id]:not(."+m+"):"+(h?"last":"first"));n&&n.length&&(d?n=k.add(k[h?"prevUntil":"nextUntil"]("#"+n.attr("id"))).add(n):i.trigger(f),n.trigger(e),E(n.filter(h?":first":":last")),D())},A=function(a){R.find("#"+a).trigger(e)},B=function(){R.find("[id]."+l).trigger(f)},C=function(){return a.map(R.find("[id]."+l),function(b){b=a(b);return b.is("."+m)?null:a(b).attr("id")})},D=function(){b.trigger("select",{selected:C()})},E=function(a){var b=a.position().top,c=a.outerHeight(!0),d=R.innerHeight(),e=R.scrollTop();b<0?R.scrollTop(Math.ceil(b+e)-9):b+c>d&&R.scrollTop(Math.ceil(b+c-d+e))},F=[],G=function(a){var b=F.length;while(b--)if(F[b].hash==a)return b;return-1},H="scroll."+b.namespace,I=function(){var d=[],e=!1,f=[],g={},h=R.find("[id]:last"),i=!h.length,j=c?R.children("table").children("tbody"):R,k;if(!F.length)return R.unbind(H);while((!h.length||R.innerHeight()-h.position().top+b.options.showThreshold>0)&&(k=F.splice(0,b.options.showFiles)).length)d=a.map(k,function(a){if(a.hash&&a.name){a.mime=="directory"&&(e=!0),a.tmb&&(a.tmb===1?f.push(a.hash):g[a.hash]=a.tmb);return x(a)}return null}),j.append(d.join("")),h=R.find("[id]:last"),i&&R.scrollTop(0);L(g),f.length&&M(f),e&&K()},J=a.extend({},b.droppable,{over:function(c,d){var e=b.cwd().hash;a.each(d.helper.data("files"),function(a,c){if(b.file(c).phash==e){R.removeClass(q);return!1}})}}),K=function(){setTimeout(function(){R.find(".directory:not(."+o+",.elfinder-na,.elfinder-ro)").droppable(b.droppable)},20)},L=function(c){var d=b.option("tmbUrl"),e=!0,f;a.each(c,function(b,c){var g=R.find("#"+b);g.length?function(b,c){a("<img/>").load(function(){b.find(".elfinder-cwd-icon").css("background","url('"+c+"') center center no-repeat")}).attr("src",c)}(g,d+c):(e=!1,(f=G(b))!=-1&&(F[f].tmb=c))});return e},M=function(a){var c=[];if(b.oldAPI)b.request({data:{cmd:"tmb",current:b.cwd().hash},preventFail:!0}).done(function(a){L(a.images||[])&&a.tmb&&M()});else while((c=a.splice(0,s)).length)b.request({data:{cmd:"tmb",targets:c},preventFail:!0}).done(function(a){!L(a.images||[])})},N=function(a){var d=c?R.find("tbody"):R,e=a.length,f=[],g={},h=!1,i=function(a){var c=R.find("[id]:first"),d;while(c.length){d=b.file(c.attr("id"));if(d&&b.compare(a,d)<0)return c;c=c.next("[id]")}},j=function(a){var c=F.length,d;for(d=0;d<c;d++)if(b.compare(a,F[d])<0)return d;return c||-1},k,l,m,n;while(e--){k=a[e],l=k.hash;if(R.find("#"+l).length)continue;(m=i(k))&&m.length?m.before(x(k)):(n=j(k))>=0?F.splice(n,0,k):d.append(x(k)),R.find("#"+l).length&&(k.mime=="directory"?h=!0:k.tmb&&(k.tmb===1?f.push(l):g[l]=k.tmb))}L(g),f.length&&M(f),h&&K()},O=function(a){var c=a.length,d,e,f;while(c--){d=a[c];if((e=R.find("#"+d)).length)try{e.detach()}catch(g){b.debug("error",g)}else(f=G(d))!=-1&&F.splice(f,1)}},P={name:b.i18n(b.res("msg","name")),perm:b.i18n(b.res("msg","perms")),mod:b.i18n(b.res("msg","modify")),size:b.i18n(b.res("msg","size")),kind:b.i18n(b.res("msg","kind"))},Q=function(d,e){var f=b.cwd().hash;try{R.children("table,"+k).remove().end()}catch(g){R.html("")}R.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-"+(c?"list":"icons")),c&&R.html('<table><thead><tr class="ui-state-default"><td >'+P.name+"</td><td>"+P.perm+"</td><td>"+P.mod+"</td><td>"+P.size+"</td><td>"+P.kind+"</td></tr></thead><tbody/></table>"),F=a.map(d,function(a){return e||a.phash==f?a:null}),F=b.sortFiles(F),R.bind(H,I).trigger(H),D()},R=a(this).addClass("elfinder-cwd").attr("unselectable","on").delegate(k,"click."+b.namespace,function(b){var c=this.id?a(this):a(this).parents("[id]:first"),d=c.prevAll("."+l+":first"),g=c.nextAll("."+l+":first"),h=d.length,i=g.length,j;b.stopImmediatePropagation(),b.shiftKey&&(h||i)?(j=h?c.prevUntil("#"+d.attr("id")):c.nextUntil("#"+g.attr("id")),j.add(c).trigger(e)):b.ctrlKey||b.metaKey?c.trigger(c.is("."+l)?f:e):(R.find("[id]."+l).trigger(f),c.trigger(e)),D()}).delegate(k,"dblclick."+b.namespace,function(a){b.dblclick({file:this.id})}).delegate(k,"mouseenter."+b.namespace,function(d){var e=a(this),f=c?e:e.children();!e.is("."+r)&&!f.is("."+n+",."+m)&&f.draggable(b.draggable)}).delegate(k,"dropover",function(b,c){var d=a(this);b.preventDefault(),b.stopImmediatePropagation(),R.droppable("disable").removeClass(m+" "+q),a.inArray(d.attr("id"),c.helper.data("files"))===-1?d.children().addClass(p):d.removeClass(q)}).delegate(k,"dropout drop",function(b){var c=a(this);b.preventDefault(),b.stopImmediatePropagation(),R.droppable("enable").trigger("dropover"),c.removeClass(q),c.is("."+l)||c.children().removeClass(p)}).delegate(k,e,function(b){var c=a(this);!y&&!c.is("."+m)&&c.addClass(l).children().addClass(p)}).delegate(k,f,function(b){!y&&a(this).removeClass(l).children().removeClass(p)}).delegate(k,g,function(){var b=a(this).removeClass(l).addClass(m),d=(c?b:b.children()).removeClass(p);b.is("."+o)&&b.droppable("disable"),d.is("."+n)&&d.draggable("disable"),!c&&d.removeClass(m)}).delegate(k,h,function(){var b=a(this).removeClass(m),d=c?b:b.children();b.is("."+o)&&b.droppable("enable"),d.is("."+n)&&d.draggable("enable")}).delegate(k,"scrolltoview",function(){E(a(this))}).selectable({filter:k,stop:D,selected:function(b,c){a(c.selected).trigger(e)},unselected:function(b,c){a(c.unselected).trigger(f)}}).droppable(J).bind("create."+b.namespace,function(b,d){var e=c?R.find("tbody"):R;R.trigger("unselectall"),e.prepend(a(x(d)).addClass(r)),R.scrollTop(0)}).bind("unselectall",function(){R.find("[id]."+l+"").trigger(f),D()}).bind("selectfile",function(a,b){R.find("#"+b).trigger(e),D()}),S=a(this).parent().resize(function(){var b=0;R.siblings(".elfinder-panel:visible").each(function(){b+=a(this).outerHeight(!0)}),R.height(T.height()-U-b)}),T=S.children(".elfinder-workzone").append(this),U=R.outerHeight(!0)-R.height();b.dragUpload&&(R[0].addEventListener("dragenter",function(a){a.preventDefault(),a.stopPropagation(),R.addClass(q)},!1),R[0].addEventListener("dragleave",function(a){a.preventDefault(),a.stopPropagation(),R.removeClass(q)},!1),R[0].addEventListener("dragover",function(a){a.preventDefault(),a.stopPropagation()},!1),R[0].addEventListener("drop",function(a){a.preventDefault(),R.removeClass(q),a.dataTransfer&&a.dataTransfer.files&&a.dataTransfer.files.length&&b.upload({files:a.dataTransfer.files})},!1)),b.bind("open search",function(a){Q(a.data.files,a.type=="search")}).searchend(function(){Q(b.files())}).bind("viewchange",function(){var d=b.selected(),e=b.storage("view")=="list";e!=c&&(c=e,Q(b.files()),a.each(d,function(a,b){A(b)}),D())}).add(function(c){var d=b.cwd().hash;N(a.map(c.data.added||[],function(a){return a.phash==d?a:null}))}).change(function(c){var d=b.cwd().hash,e=b.selected();a.each(a.map(c.data.changed||[],function(a){return a.phash==d?a:null}),function(b,c){O([c.hash]),N([c]),a.inArray(c.hash,e)!==-1&&A(c.hash)}),D()}).remove(function(a){O(a.data.removed||[]),D()}).dragstart(function(b){var c=a(b.data.target),d=b.data.originalEvent;c.is(k)&&(c.is("."+l)||(!(d.ctrlKey||d.metaKey||d.shiftKey)&&B(),c.trigger(e),D()),R.droppable("disable")),R.selectable("disable").removeClass(m),y=!0}).dragstop(function(){R.selectable("enable"),y=!1}).bind("lockfiles unlockfiles",function(a){var b=a.type=="lockfiles"?g:h,c=a.data.files||[],d=c.length;while(d--)R.find("#"+c[d]).trigger(b);D()}).bind("mkdir mkfile duplicate upload rename archive",function(c){var d=b.cwd().hash,e;R.trigger("unselectall"),a.each(c.data.added||[],function(a,b){b&&b.phash==d&&A(b.hash)}),D()}).shortcut({pattern:"ctrl+a",description:"Select all files",callback:function(){R.find("[id]:not(."+l+")").trigger(e),D()}}).shortcut({pattern:"left right up down shift+left shift+right shift+up shift+down",description:"Select file(s)",type:a.browser.mozilla||a.browser.opera?"keypress":"keydown",callback:function(a){z(a.keyCode,a.shiftKey)}}).shortcut({pattern:"home",description:"Select first file",callback:function(a){B(),R.find("[id]:first").trigger(e),D()}}).shortcut({pattern:"end",description:"Select last file",callback:function(a){B(),R.find("[id]:last").trigger(e),D()}})});return this},"use strict",a.fn.elfinderdialog=function(b){var c;typeof b=="string"&&(c=this.closest(".ui-dialog")).length&&(b=="open"&&c.is(":hidden")?c.fadeIn(150,function(){c.trigger("open")}):b=="close"&&c.is(":visible")?c.hide().trigger("close"):b=="destroy"&&c.hide().remove()),b=a.extend({},a.fn.elfinderdialog.defaults,b),this.filter(":not(.ui-dialog-content)").each(function(){var c=a(this).addClass("ui-dialog-content ui-widget-content"),d=c.parent(),e="elfinder-dialog-active",f="elfinder-dialog",g="elfinder-dialog-notify",h="ui-state-hover",i=parseInt(Math.random()*1e6),j=d.children(".elfinder-overlay"),k=a('<div class="ui-dialog-buttonset"/>'),l=a('<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"/>').append(k),m=a('<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog  '+f+" "+b.cssClass+'"/>').hide().append(c).appendTo(d).draggable({handle:".ui-dialog-titlebar"}).css({width:b.width,height:b.height}).mousedown(function(b){b.stopPropagation(),a(document).mousedown(),m.is("."+e)||(d.find("."+f+":visible").removeClass(e),m.addClass(e).zIndex(n()+1))}).bind("open",function(){b.modal&&j.elfinderoverlay("show"),m.mousedown().find(".ui-button:first").focus(),m.find(":text:first").focus(),typeof b.open=="function"&&a.proxy(b.open,c[0])(),m.is("."+g)||d.find("."+f+":visible").not("."+g).each(function(){var b=a(this),c=parseInt(b.css("top")),d=parseInt(b.css("left")),e=parseInt(m.css("top")),f=parseInt(m.css("left"));b[0]!=m[0]&&(c>=e||d>=f)&&m.css({top:c+10+"px",left:d+10+"px"})})}).bind("close",function(){var e=d.find(".elfinder-dialog:visible"),f=n();b.modal&&j.elfinderoverlay("hide"),e.length?e.each(function(){var b=a(this);if(b.zIndex()>=f){b.mousedown();return!1}}):d.mousedown(),typeof b.close=="function"?a.proxy(b.close,c[0])():b.destroyOnClose&&m.hide().remove()}),n=function(){var b=d.zIndex()+10;d.find("."+f+":visible").each(function(){var c;this!=m[0]&&(c=a(this).zIndex(),c>b&&(b=c))});return b},o;b.position||(o=parseInt((d.height()-m.outerHeight())/2-42),b.position={top:(o>0?o:0)+"px",left:parseInt((d.width()-m.outerWidth())/2)+"px"}),m.css(b.position),b.closeOnEscape&&a(document).bind("keyup."+i,function(b){b.keyCode==a.ui.keyCode.ESCAPE&&m.is("."+e)&&(c.elfinderdialog("close"),a(document).unbind("keyup."+i))}),m.prepend(a('<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+b.title+"</div>").prepend(a('<a href="#" class="ui-dialog-titlebar-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/></a>').mousedown(function(a){a.preventDefault(),c.elfinderdialog("close")}))),a.each(b.buttons,function(b,d){var e=a('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+b+"</span></button>").click(a.proxy(d,c[0])).hover(function(b){a(this)[b.type=="mouseenter"?"focus":"blur"]()}).focus(function(){a(this).addClass(h)}).blur(function(){a(this).removeClass(h)}).keydown(function(b){var c;b.keyCode==a.ui.keyCode.ENTER?a(this).click():b.keyCode==a.ui.keyCode.TAB&&(c=a(this).next(".ui-button"),c.length?c.focus():a(this).parent().children(".ui-button:first").focus())});k.append(e)}),k.children().length&&m.append(l),b.resizable&&a.fn.resizable&&m.resizable({minWidth:b.minWidth,minHeight:b.minHeight,alsoResize:this}),typeof b.create=="function"&&a.proxy(b.create,this)(),b.autoOpen&&c.elfinderdialog("open")});return this},a.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:!1,resizable:!0,autoOpen:!0,closeOnEscape:!0,buttons:{},position:null,width:300,height:"auto",minWidth:200,minHeight:110},a.fn.elfindernavbar=function(b){this.not(".elfinder-navbar").each(function(){var c=a(this).addClass("ui-state-default elfinder-navbar"),d=c.parent().resize(function(){c.height(e.height()-f),k&&k.length&&i()}),e=d.children(".elfinder-workzone").append(c),f=c.outerHeight()-c.height(),g=b.direction=="ltr",h=g?"left":"right",i=function(){k.css(h,parseInt(j.offset()[h])-k.outerWidth()+"px")},j,k;a.fn.resizable&&(k=a('<span class="elfinder-nav-handle-icon ui-icon ui-icon-grip-solid-vertical"/>').prependTo(e).zIndex(c.zIndex()+10),j=c.resizable({handles:g?"e":"n"}).resize(i).scroll(function(){j.css("top",parseInt(c.scrollTop())+"px")}).find(".ui-resizable-handle"),b.one("open",function(){setTimeout(function(){d.trigger("resize")},100)}))});return this},a.fn.elfinderoverlay=function(b){this.filter(":not(.elfinder-overlay)").each(function(){b=a.extend({},b),a(this).addClass("ui-widget-overlay elfinder-overlay").hide().mousedown(function(a){a.preventDefault(),a.stopPropagation()}).data({cnt:0,show:typeof b.show=="function"?b.show:function(){},hide:typeof b.hide=="function"?b.hide:function(){}})});if(b=="show"){var c=this.eq(0),d=c.data("cnt")+1,e=c.data("show");c.data("cnt",d),c.is(":hidden")&&(c.zIndex(c.parent().zIndex()+1),c.show(),e())}if(b=="hide"){var c=this.eq(0),d=c.data("cnt")-1,f=c.data("hide");c.data("cnt",d),d==0&&c.is(":visible")&&(c.hide(),f())}return this},a.fn.elfinderpanel=function(b){return this.each(function(){var c=a(this).addClass("elfinder-panel ui-state-default ui-corner-all"),d="margin-"+(b.direction=="ltr"?"left":"right");b.one("load",function(a){var e=b.getUI("navbar");c.css(d,parseInt(e.outerWidth(!0))),e.bind("resize",function(){c.is(":visible")&&c.css(d,parseInt(e.outerWidth(!0)))})})})},"use strict",a.fn.elfinderpath=function(b){return this.each(function(){var c=a(this).addClass("elfinder-path").html("&nbsp;path").delegate("a","click",function(c){var d=a(this).attr("href").substr(1);c.preventDefault(),d!=b.cwd().hash&&b.exec("open",d)}).prependTo(b.getUI("statusbar").show());b.bind("open searchend",function(){var d=[];a.each(b.parents(b.cwd().hash),function(a,c){d.push('<a href="#'+c+'">'+b.escape(b.file(c).name)+"</a>")}),c.html(d.join(b.option("separator")))}).bind("search",function(){c.html(b.i18n(b.res("msg","searchres")))})})},"use strict",a.fn.elfinderplaces=function(b){return this.each(function(){var c=[],d="class",e=b.res(d,"navdir"),f=b.res(d,"navcollapse"),g=b.res(d,"navexpand"),h=b.res(d,"hover"),i=b.res("tpl","navdir"),j=b.res("tpl","perms"),k=a(b.res("tpl","navspinner")),l=function(a){return a.substr(6)},m=function(a){return"place-"+a},n=function(){b.storage("places",c.join(","))},o=function(c){return a(i.replace(/\{id\}/,m(c.hash)).replace(/\{name\}/,b.escape(c.name)).replace(/\{cssclass\}/,b.perms2class(c)).replace(/\{permissions\}/,!c.read||!c.write?j:"").replace(/\{symlink\}/,""))},p=function(d){var g=o(d);u.children().length&&a.each(u.children(),function(){var b=a(this);if(d.name.localeCompare(b.children("."+e).text())<0)return!g.insertBefore(b)}),c.push(d.hash),!g.parent().length&&u.append(g),t.addClass(f),g.draggable({appendTo:"body",revert:!1,helper:function(){var c=a(this);c.children().removeClass("ui-state-hover");return a('<div class="elfinder-place-drag elfinder-'+b.direction+'"/>').append(c.clone()).data("hash",l(c.children(":first").attr("id")))},start:function(){a(this).hide()},stop:function(b,c){var d=v.offset().top,e=v.offset().left,f=v.width(),g=v.height(),h=b.clientX,i=b.clientY;h>e&&h<e+f&&i>d&&i<i+g?a(this).show():(q(c.helper.data("hash")),n())}})},q=function(b){var d=a.inArray(b,c);d!==-1&&(c.splice(d,1),u.find("#"+m(b)).parent().remove(),!u.children().length&&t.removeClass(f+" "+g))},r=function(){u.empty(),t.removeClass(f+" "+g)},s=o({hash:"root-"+b.namespace,name:b.i18n(b.res("msg","places")),read:!0,write:!0}),t=s.children("."+e).addClass(b.res(d,"treeroot")).click(function(){t.is("."+f)&&(v.toggleClass(g),u.slideToggle())}),u=s.children("."+b.res(d,"navsubtree")),v=a(this).addClass(b.res(d,"tree")+" elfinder-places ui-corner-all").hide().append(s).appendTo(b.getUI("navbar")).delegate("."+e,"hover",function(){a(this).toggleClass("ui-state-hover")}).delegate("."+e,"click",function(c){b.exec("open",a(this).attr("id").substr(6))}).droppable({tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file",hoverClass:b.res("class","adroppable"),drop:function(d,e){var f=!0;a.each(e.helper.data("files"),function(d,e){var g=b.file(e);g&&g.mime=="directory"&&a.inArray(g.hash,c)===-1?p(g):f=!1}),n(),f&&e.helper.hide()}});b.one("load",function(){b.oldAPI||(v.show().parent().show(),c=a.map(b.storage("places").split(","),function(a){return a||null}),c.length&&(t.prepend(k),b.request({data:{cmd:"info",targets:c},preventDefault:!0}).done(function(b){c=[],a.each(b.files,function(a,b){b.mime=="directory"&&p(b)}),n()}).always(function(){k.remove()})),b.remove(function(b){a.each(b.data.removed,function(a,b){q(b)}),n()}).change(function(b){a.each(b.data.changed,function(b,d){a.inArray(d.hash,c)!==-1&&(q(d.hash),d.mime=="directory"&&p(d))}),n()}).bind("sync",function(){c.length&&(t.prepend(k),b.request({data:{cmd:"info",targets:c},preventDefault:!0}).done(function(b){a.each(b.files||[],function(b,d){a.inArray(d.hash,c)===-1&&q(d.hash)}),n()}).always(function(){k.remove()}))}))})})},"use strict",a.fn.elfindersearchbutton=function(b){return this.each(function(){var c=!1,d=a(this).hide().addClass("ui-widget-content elfinder-button "+b.fm.res("class","searchbtn")+""),e=function(){b.exec(a.trim(g.val())).done(function(){c=!0,g.focus()})},f=function(){g.val(""),c&&(c=!1,b.fm.trigger("searchend"))},g=a('<input type="text" size="42"/>').appendTo(d).keypress(function(a){a.stopPropagation()}).keydown(function(a){a.stopPropagation(),a.keyCode==13&&e(),a.keyCode==27&&(a.preventDefault(),f())});a('<span class="ui-icon ui-icon-search" title="'+b.title+'"/>').appendTo(d).click(e),a('<span class="ui-icon ui-icon-close"/>').appendTo(d).click(f),setTimeout(function(){d.parent().detach(),b.fm.getUI("toolbar").prepend(d.show());if(a.browser.msie){var c=d.children(b.fm.direction=="ltr"?".ui-icon-close":".ui-icon-search");c.css({right:"",left:parseInt(d.width())-c.outerWidth(!0)})}},200),b.fm.error(function(){g.unbind("keydown")}).select(function(){g.blur()}).viewchange(f).shortcut({pattern:"ctrl+f f3",description:b.title,callback:function(){g.select().focus()}})})},"use strict",a.fn.elfinderstat=function(b){return this.each(function(){var c=a(this).addClass("elfinder-stat-size"),d=a('<div class="elfinder-stat-selected"/>'),e=b.i18n(b.res("msg","size")),f=b.i18n(b.res("msg","items")),g=b.i18n(b.res("msg","selitems")),h=function(d,g){var h=0,i=0;a.each(d,function(a,b){if(!g||b.phash==g)h++,i+=b.size||0}),c.html(f+": "+h+", "+e+": "+b.formatSize(i))};b.getUI("statusbar").prepend(c).append(d).show(),b.bind("open reload add remove change searchend",function(){h(b.files(),b.cwd().hash)}).search(function(a){h(a.data.files)}).select(function(){var c=0,f=0;a.each(b.selectedFiles(),function(a,b){f++,c+=b.size||0}),d.html(f?g+": "+f+", "+e+": "+b.formatSize(c):"&nbsp;")})})},"use strict",a.fn.elfindertoolbar=function(b,c){this.not(".elfinder-toolbar").each(function(){var d=b._commands,e=a(this).addClass("ui-helper-clearfix ui-widget-header ui-corner-top elfinder-toolbar"),f=c||[],g=f.length,h,i,j,k;e.prev().length&&e.parent().prepend(this);while(g--){j=a('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>'),h=f[g].length;while(h--)if(i=d[f[g][h]])k="elfinder"+i.options.ui,a.fn[k]&&(j.prepend(a("<div/>")[k](i)),h>0&&j.prepend('<span class="ui-widget-content elfinder-toolbar-button-separator"/>'));j.children().length&&e.prepend(j)}e.children().length&&e.show()});return this},"use strict",a.fn.elfindertree=function(b,c){var d=b.res("class","tree");this.not("."+d).each(function(){var e="class",f=b.res(e,"treeroot"),g=c.openRootOnLoad,h=b.res(e,"navsubtree"),i=b.res(e,"treedir"),j=b.res(e,"navcollapse"),k=b.res(e,"navexpand"),l="elfinder-subtree-loaded",m=b.res(e,"navarrow"),n=b.res(e,"active"),o=b.res(e,"adroppable"),p=b.res(e,"hover"),q=b.res(e,"disabled"),r=b.res(e,"draggable"),s=b.res(e,"droppable"),t=a.extend({},b.droppable,{hoverClass:p+" "+o,over:function(){var b=a(this);b.is("."+j+":not(."+k+")")&&setTimeout(function(){b.is("."+o)&&b.children("."+m).click()},500)}}),u=a(b.res("tpl","navspinner")),v=b.res("tpl","navdir"),w=b.res("tpl","perms"),x=b.res("tpl","symlink"),y={id:function(a){return b.navHash2Id(a.hash)},cssclass:function(a){return(a.phash?"":f)+" "+i+" "+b.perms2class(a)+" "+(a.dirs&&!a.link?j:"")},permissions:function(a){return!a.read||!a.write?w:""},symlink:function(a){return a.alias?x:""}},z=function(a){a.name=b.escape(a.name);return v.replace(/(?:\{([a-z]+)\})/ig,function(b,c){return a[c]||(y[c]?y[c](a):"")})},A=function(b){return a.map(b||[],function(a){return a.mime=="directory"?a:null})},B=function(a){return a?H.find("#"+b.navHash2Id(a)).next("."+h):H},C=function(c,d){var e=c.children(":first"),f;while(e.length){if((f=b.file(b.navId2Hash(e.children("[id]").attr("id"))))&&d.name.localeCompare(f.name)<0)return e;e=e.next()}return a("")},D=function(a){var c=a.length,d=[],e,f,g,h,i;for(e=0;e<c;e++){f=a[e];if(H.find("#"+b.navHash2Id(f.hash)).length)continue;(h=B(f.phash)).length?(g=z(f),f.phash&&(i=C(h,f)).length?i.before(g):h.append(g)):d.push(f)}if(d.length&&d.length<c)return D(d);F()},E=function(){var a=b.cwd().hash,d=H.find("#"+b.navHash2Id(a)),e;g&&(e=H.find("#"+b.navHash2Id(b.root())),e.is("."+l)&&e.addClass(k).next("."+h).show(),g=!1),d.is("."+n)||(H.find("."+i+"."+n).removeClass(n),d.addClass(n)),c.syncTree&&(d.length?d.parentsUntil("."+f).filter("."+h).show().prev("."+i).addClass(k):b.newAPI&&b.request({data:{cmd:"parents",target:a},preventFail:!0}).done(function(c){var d=A(c.tree);D(d),G(d,l),a==b.cwd().hash&&E()}))},F=function(){H.find("."+i+":not(."+s+",.elfinder-ro,.elfinder-na)").droppable(t)},G=function(c,d){var e=d==l?"."+j+":not(."+l+")":":not(."+j+")";a.each(c,function(c,f){H.find("#"+b.navHash2Id(f.phash)+e).filter(function(){return a(this).next("."+h).children().length>0}).addClass(d)})},H=a(this).addClass(d).delegate("."+i,"hover",function(c){var d=a(this),e=c.type=="mouseenter";d.is("."+o+" ,."+q)||(e&&!d.is("."+f+",."+r+",.elfinder-na,.elfinder-wo")&&d.draggable(b.draggable),d.toggleClass(p,e))}).delegate("."+i,"dropover dropout drop",function(b){a(this)[b.type=="dropover"?"addClass":"removeClass"](o+" "+p)}).delegate("."+i,"click",function(c){var d=a(this),e=b.navId2Hash(d.attr("id"));e!=b.cwd().hash&&!d.is("."+q)?b.exec("open",e):d.is("."+j)&&d.children("."+m).click()}).delegate("."+i+"."+j+" ."+m,"click",function(c){var d=a(this),e=d.parent("."+i),f=e.next("."+h);c.stopPropagation(),e.is("."+l)?(e.toggleClass(k),f.slideToggle()):(u.insertBefore(d),e.removeClass(j),b.request({cmd:"tree",target:b.navId2Hash(e.attr("id"))}).done(function(a){D(A(a.tree)),f.children().length&&(e.addClass(j+" "+k),f.slideDown()),E()}).always(function(a){u.remove(),e.addClass(l)}))});H.parent().find(".elfinder-navbar").append(H).show(),b.open(function(a){var b=a.data,c=A(b.files);b.init&&H.empty(),c.length&&(D(c),G(c,l)),E()}).add(function(a){var b=A(a.data.added);b.length&&(D(b),G(b,j))}).change(function(c){var d=A(c.data.changed),e=d.length,f,g,j,m,n,o,p,q,r;while(e--){f=d[e];if((g=H.find("#"+b.navHash2Id(f.hash))).length){if(f.phash){m=g.closest("."+h),n=B(f.phash),o=g.parent().next(),p=C(n,f);if(!n.length)continue;if(n[0]!==m[0]||o.get(0)!==p.get(0))p.length?p.before(g):n.append(g)}q=g.is("."+k),r=g.is("."+l),j=a(z(f)),g.replaceWith(j.children("."+i)),f.dirs&&(q||r)&&(g=H.find("#"+b.navHash2Id(f.hash)))&&g.next("."+h).children().length&&(q&&g.addClass(k),r&&g.addClass(l))}}E(),F()}).remove(function(a){var c=a.data.removed,d=c.length,e,f;while(d--)(e=H.find("#"+b.navHash2Id(c[d]))).length&&(f=e.closest("."+h),e.parent().detach(),f.children().length||f.hide().prev("."+i).removeClass(j+" "+k+" "+l))}).bind("search searchend",function(a){H.find("#"+b.navHash2Id(b.cwd().hash))[a.type=="search"?"removeClass":"addClass"](n)}).bind("lockfiles unlockfiles",function(c){var d=c.type=="lockfiles",e=d?"disable":"enable",f=a.map(c.data.files||[],function(a){var c=b.file(a);return c&&c.mime=="directory"?a:null});a.each(f,function(a,c){var f=H.find("#"+b.navHash2Id(c));f.length&&(f.is("."+r)&&f.draggable(e),f.is("."+s)&&f.droppable(n),f[d?"addClass":"removeClass"](q))})})});return this},"use strict",a.fn.elfinderuploadbutton=function(b){return this.each(function(){var c=a(this).elfinderbutton(b).unbind("click"),d=a("<form/>").appendTo(c),e=a('<input type="file" multiple="true"/>').appendTo(d).change(function(){var a;e.val()&&(a=e.clone(!0),b.exec({input:e.remove()[0]}),e=a.appendTo(d))})})},"use strict",a.fn.elfinderviewbutton=function(b){return this.each(function(){var c=a(this).elfinderbutton(b),d=c.children(".elfinder-button-icon");b.change(function(){var a=b.value=="icons";d.toggleClass("elfinder-button-icon-view-list",a),c.attr("title",b.fm.i18n(a?"View as list":"View as icons"))})})},"use strict",a.fn.elfinderworkzone=function(b){var c="elfinder-workzone";this.not("."+c).each(function(){var b=a(this).addClass(c),d=b.outerHeight(!0)-b.height(),e=b.parent();e.add(window).bind("resize",function(){var f=e.height();e.children(":visible:not(."+c+")").each(function(){var b=a(this);b.css("position")!="absolute"&&(f-=b.outerHeight(!0))}),b.height(f-d)})});return this},"use strict",elFinder.prototype.commands.archive=function(){var b=this,c=b.fm,d=[];this.variants=[],this.disableOnSearch=!0,c.bind("open reload",function(){b.variants=[],a.each(d=c.option("archivers").create||[],function(a,d){b.variants.push([d,c.mime2kind(d)])}),b.change()}),this.getstate=function(){return d.length&&c.selected().length&&c.cwd().write?0:-1},this.exec=function(b,e){var f=this.files(b),g=f.length,h=e||d[0],i=c.cwd(),j=[c.errmsg("archive"),c.errmsg("denied")],k=a.Deferred().fail(function(a){a&&c.error(a)}),l;if(!g||!d.length||a.inArray(h,d)===-1)return k.reject();if(!i.write)return k.reject(j);for(l=0;l<g;l++)if(!f[l].read)return k.reject(j);return c.request({data:{cmd:"archive",targets:this.hashes(b),type:h},notify:{type:"archive",cnt:1},syncOnFail:!0})}},"use strict",elFinder.prototype.commands.back=function(){this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+left backspace"}],this.getstate=function(){return this.fm.history.canBack()?0:-1},this.exec=function(){return this.fm.history.back()}},"use strict",elFinder.prototype.commands.copy=function(){this.shortcuts=[{pattern:"ctrl+c ctrl+insert"}],this.getstate=function(b){var b=this.files(b),c=b.length;return c&&a.map(b,function(a){return a.phash&&a.read?a:null}).length==c?0:-1},this.exec=function(b){var c=this.fm,d=a.Deferred().fail(function(a){c.error(a)});a.each(this.files(b),function(a,b){if(!b.read||!b.phash)return!d.reject([c.errmsg("copy"),b.name,c.errmsg("denied")])});return d.isRejected()?d:d.resolve(c.clipboard(this.hashes(b)))}},"use strict",elFinder.prototype.commands.cut=function(){this.shortcuts=[{pattern:"ctrl+x shift+insert"}],this.getstate=function(b){var b=this.files(b),c=b.length;return c&&a.map(b,function(a){return a.phash&&a.read&&!a.locked?a:null}).length==c?0:-1},this.exec=function(b){var c=this.fm,d=c.errors(),e=a.Deferred().fail(function(a){c.error(a)});a.each(this.files(b),function(a,b){if(!b.read||!b.phash)return!e.reject([d.copy,b.name,d.denied]);if(b.locked)return!e.reject([d.locked,b.name])});return e.isRejected()?e:e.resolve(c.clipboard(this.hashes(b),!0))}},"use strict",elFinder.prototype.commands.download=function(){var b=this,c=this.fm,d=function(c){return a.map(b.files(c),function(a){return a.mime=="directory"?null:a})};this.alwaysEnabled=!0,this.shortcuts=[{pattern:"shift+enter"}],this.getstate=function(){var a=this.fm.selected(),b=a.length;return b&&b==d(a).length?0:-1},this.exec=function(b){var c=this.fm,e=c.options.url,f=d(b),g=a.Deferred(),h,i,j;if(c.oldAPI){c.error(c.res("error","cmdsupport"));return g.reject()}e+=e.indexOf("?")===-1?"?":"&";for(i=0;i<f.length;i++)var h=a('<iframe style="display:none" src="'+e+"cmd=file&target="+f[i].hash+"&download=1"+'"/>').appendTo("body").load(function(){setTimeout(function(){h.remove()},1e3)});return g.resolve(b)}},"use strict",elFinder.prototype.commands.duplicate=function(){var b=this.fm;this.disableOnSearch=!0,this.getstate=function(c){var c=this.files(c),d=c.length;return d&&b.cwd().write&&a.map(c,function(a){return a.phash&&a.read?a:null}).length==d?0:-1},this.exec=function(b){var c=this.fm,d=c.errors(),e=this.files(b),f=e.length,g=a.Deferred().fail(function(a){a&&c.error(a)}),h=[];if(!f)return g.reject();a.each(e,function(a,b){if(!b.read)return!g.reject([d.copy,b.name,d.denied]);if(!c.file(b.phash).write)return!g.reject([d.copy,b.name,d.denied])});if(g.isRejected())return g;return c.request({data:{cmd:"duplicate",targets:this.hashes(b)},notify:{type:"copy",cnt:f}})}},"use strict",elFinder.prototype.commands.edit=function(){var b=this,c=this.fm,d=c.res("mimes","text"),e=function(b){return a.map(b,function(b){return b.mime.indexOf("text/")===0||a.inArray(b.mime,d)!==-1&&b.read&&b.write?b:null})},f=function(d){var e=d.hash,f=c.errors(),g=c.options,h=a.Deferred(),i={cmd:"file",target:e},j=c.url(e)||c.options.url,k=function(f){var g=a('<textarea class="elfinder-file-edit" rows="20">'+f+"</textarea>").keydown(function(a){var b=a.keyCode,c,d;a.stopPropagation(),b==9&&(a.preventDefault(),this.setSelectionRange&&(c=this.value,d=this.selectionStart,this.value=c.substr(0,d)+"\t"+c.substr(this.selectionEnd),d+=1,this.setSelectionRange(d,d)));if(a.ctrlKey||a.metaKey){if(b==81||b==87)a.preventDefault(),j();b==83&&(a.preventDefault(),k())}}),i={title:d.name,width:b.options.dialogWidth||450,buttons:{},close:function(){a(this).elfinderdialog("destroy")},open:function(){c.disable(),g.focus(),g[0].setSelectionRange&&g[0].setSelectionRange(0,0)}},j=function(){h.resolve(),g.elfinderdialog("close")},k=function(){var a=g.val();g.elfinderdialog("close"),c.request({options:{type:"post"},data:{cmd:"put",target:e,content:a},notify:{type:"save",cnt:1},syncOnFail:!0}).fail(function(a){h.reject(a)}).done(function(a){a.changed&&a.changed.length&&c.change(a),h.resolve(a)})};i.buttons[c.i18n("Save")]=k,i.buttons[c.i18n("Cancel")]=j,c.dialog(g,i)},l;if(!d.read||!d.write){l=[f.open,d.name,f.denied],c.error(l);return h.reject(l)}c.request({data:{cmd:"get",target:e},notify:{type:"openfile",cnt:1}}).done(function(a){k(a.content)}).fail(function(a){h.reject(a)});return h};this.shortcuts=[{pattern:"ctrl+e"}],this.getstate=function(a){var a=this.files(a),b=a.length;return b&&e(a).length==b?0:-1},this.exec=function(b){var c=e(this.files(b)),d=[],g;while(g=c.shift())d.push(f(g));return d.length?a.when.apply(null,d):a.Deferred().reject()}},"use strict",elFinder.prototype.commands.extract=function(){var b=this,c=b.fm,d=[],e=function(b){return a.map(b,function(b){return b.read&&a.inArray(b.mime,d)!==-1?b:null})};this.disableOnSearch=!0,c.bind("open reload",function(){d=c.option("archivers").extract||[],b.change()}),this.getstate=function(a){var a=this.files(a),b=a.length;return b&&e(a).length==b?0:-1},this.exec=function(b){var e=this.files(b),f=a.Deferred(),g=c.errors(),h=e.length,i=h,j,k,l;if(!h||!d.length)return f.reject();for(j=0;j<h;j++){k=e[j];if(!k.read||!c.file(k.phash).write){l=[g.extract,k.name,g.denied],c.error(l);return f.reject(l)}if(a.inArray(k.mime,d)===-1){l=[g.extract,k.name,g.notarchive],c.error(l);return f.reject(l)}c.request({data:{cmd:"extract",target:k.hash},notify:{type:"extract",cnt:1},syncOnFail:!0}).fail(function(a){c.error(a),f.isRejected()||f.reject(a)}).done(function(){i--,i==0&&f.resolve()})}return f}},elFinder.prototype.commands.forward=function(){this.alwaysEnabled=!0,this.updateOnSelect=!0,this.shortcuts=[{pattern:"ctrl+right"}],this.getstate=function(){return this.fm.history.canForward()?0:-1},this.exec=function(){return this.fm.history.forward()}},"use strict",elFinder.prototype.commands.getfile=function(){var b=this,c=this.fm,d=function(c){var d=b.options;c=a.map(c,function(a){return a.mime!="directory"||d.folders?a:null});return d.multiple||c.length==1?c:[]};this.alwaysEnabled=!0,this.callback=c.options.getFileCallback,this._disabled=typeof this.callback=="function",this.getstate=function(a){var a=this.files(a),b=a.length;return this.callback&&b&&d(a).length==b?0:-1},this.exec=function(c){var d=this.fm,e=this.options,f=this.files(c),g=f.length,h=d.option("url"),i=d.option("tmbUrl"),j=a.Deferred().done(function(a){d.trigger("getfile",{files:a}),b.callback(a,d),e.oncomplete=="close"?d.hide():e.oncomplete=="destroy"&&d.destroy()}),k,l;if(this.getstate()==-1)return j.reject();for(k=0;k<g;k++){l=f[k];if(l.mime=="directory"&&!e.folders)return j.reject();l.baseUrl=h,l.url=d.url(l.hash),l.path=d.path(l.hash),l.tmb&&l.tmb!=1&&(l.tmb=i+l.tmb)}return j.resolve(e.multiple?f:f[0])}},"use strict",elFinder.prototype.commands.help=function(){var b=this.fm,c;this.alwaysEnabled=!0,this.updateOnSelect=!1,this.state=0,this.shortcuts=[{pattern:"f1",description:this.title}],this.fm.one("open",function(){setTimeout(function(){var d='<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>',e='<div class="elfinder-help-team"><div>{author}</div>{work}</div>',f=/\{url\}/,g=/\{link\}/,h=/\{author\}/,i=/\{work\}/,j="replace",k="ui-priority-primary",l="ui-priority-secondary",m="elfinder-help-license",n='<li class="ui-state-default ui-corner-top"><a href="#{id}">{title}</a></li>',o=['<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help">','<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">'],p='<div class="elfinder-help-shortcut"><div class="elfinder-help-shortcut-pattern">{pattern}</div> {descrip}</div>',q='<div class="elfinder-help-separator"/>',r=b.shortcuts();a.each({main:"About",shortcuts:"Shortcuts",help:"Help"},function(a,c){o.push(n[j](/\{id\}/,a)[j](/\{title\}/,b.i18n(c)))}),o.push("</ul>"),o.push('<div id="main" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><div class="elfinder-help-logo"/>'),o.push("<h3>elFinder</h3>"),o.push('<div class="'+k+'">'+b.i18n("Web file manager")+"</div>"),o.push('<div class="'+l+'">'+b.i18n("Version")+": "+b.version+", "+b.i18n("protocol version")+": "+b.api+"</div>"),o.push('<div class="'+l+'">jQuery/jQuery UI: '+a().jquery+"/"+a.ui.version+"</div>"),o.push(q),o.push(d[j](f,"http://elrte.org/elfider/")[j](g,b.i18n("Project home"))),o.push(d[j](f,"http://elrte.org/elfider/")[j](g,b.i18n("Documentation"))),o.push(d[j](f,"https://github.com/Studio-42/elFinder")[j](g,b.i18n("Fork us on Github"))),o.push(d[j](f,"http://twitter.com/#!/elrte_elfinder")[j](g,b.i18n("Follow us in twitter"))),o.push(d[j](f,"http://facebook.com/")[j](g,b.i18n("Meet us on facebook"))),o.push(q),o.push('<div class="'+k+'">'+b.i18n("Team")+"</div>"),o.push(e[j](h,'Dmitry "dio" &lt;dio@std42.ru&gt;')[j](i,b.i18n("chief developer"))),o.push(e[j](h,"Troex Nevelin &lt;troex@fury.scancode.ru&gt;")[j](i,b.i18n("mantainer")+", "+b.i18n("developer"))),o.push(e[j](h,"Alexey Sukhotin &lt;strogg@yandex.ru&gt;")[j](i,b.i18n("developer"))),b.i18[b.lang].translator&&o.push(e[j](h,b.i18[b.lang].translator)[j](i,b.i18n("translator")+" ("+b.i18[b.lang].language+")")),o.push(e[j](h,b.i18n("Icons"))[j](i,'<a href="http://pixelmixer.ru/" target="_blank">Pixelmixer</a>, <a href="http://p.yusukekamiyamane.com" target="_blank">Fugue</a>')),o.push(q+q),o.push('<div class="'+m+'">Licence: BSD Licence</div>'),o.push('<div class="'+m+'">Copyright  2009-2011, Studio 42</div>'),o.push('<div class="'+m+'"> '+b.i18n("and don't forget to take your towel")+" </div>"),o.push("</div>"),o.push('<div id="shortcuts" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'),r.length?(o.push('<div class="ui-widget-content elfinder-help-shortcuts">'),a.each(r,function(a,b){o.push(p.replace(/\{pattern\}/,b[0]).replace(/\{descrip\}/,b[1]))}),o.push("</div>")):o.push('<div class="elfinder-help-disabled">'+b.i18n("Shortcuts disabled")+"</div>"),o.push("</div>"),o.push('<div id="help" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'),o.push('<a href="http://elrte.org/redmine/projects/elfinder/boards" target="_blank" class="elfinder-dont-panic"><span>DON&apos;T PANIC</span></a>'),o.push("</div>"),o.push("</div>"),c=a(o.join("")),c.find(".ui-tabs-nav li").hover(function(){a(this).toggleClass("ui-state-hover")}).children().click(function(b){var d=a(this);b.preventDefault(),b.stopPropagation(),d.is(".ui-tabs-selected")||(d.parent().addClass("ui-tabs-selected ui-state-active").siblings().removeClass("ui-tabs-selected").removeClass("ui-state-active"),c.find(".ui-tabs-panel").hide().filter(d.attr("href")).show())}).filter(":first").click()},200)}),this.getstate=function(){return 0},this.exec=function(){this.fm.dialog(c,{title:this.title,width:530})}},elFinder.prototype.commands.home=function(){this.title="Home",this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+home ctrl+shift+up",description:"Home"}],this.getstate=function(){var a=this.fm.root(),b=this.fm.cwd().hash;return a&&b&&a!=b?0:-1},this.exec=function(){return this.fm.exec("open",this.fm.root())}},"use strict",elFinder.prototype.commands.info=function(){var b="msg",c=this.fm,d={calc:c.res(b,"calc"),size:c.res(b,"size"),unknown:c.res(b,"unknown"),path:c.res(b,"path"),aliasfor:c.res(b,"aliasfor"),modify:c.res(b,"modify"),perms:c.res(b,"perms"),locked:c.res(b,"locked"),dim:c.res(b,"dim"),kind:c.res(b,"kind"),files:c.res(b,"files"),folders:c.res(b,"folders"),items:c.res(b,"items"),yes:c.res(b,"yes"),no:c.res(b,"no"),link:c.res(b,"link")};this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}</div><table class="elfinder-info-tb">{content}</table>',itemTitle:'<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>',groupTitle:"<strong>{items}: {num}</strong>",row:"<tr><td>{label} : </td><td>{value}</td></tr>",spinner:'<span>{text}</span> <span class="elfinder-spinner-mini"/>'},this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+i"}],this.init=function(){a.each(d,function(a,b){d[a]=c.i18n(b)})},this.getstate=function(){return 0},this.exec=function(b){var c=this,e=this.fm,f=this.tpl,g=f.row,h=this.files(b),i=h.length,j=[],k=f.main,l="{label}",m="{value}",n={title:this.title,width:"auto",close:function(){a(this).elfinderdialog("destroy")}},o=[],p,q,r,s,t,u;if(!i)return a.Deferred().reject();i==1?(s=h[0],k=k.replace("{class}",e.mime2class(s.mime)),t=f.itemTitle.replace("{name}",s.name).replace("{kind}",e.mime2kind(s)),s.tmb&&(r=e.option("tmbUrl")+s.tmb),s.read?s.mime!="directory"||s.alias?q=e.formatSize(s.size):(q=f.spinner.replace("{text}",d.calc),o.push(s.hash)):q=d.unknown,j.push(g.replace(l,d.size).replace(m,q)),s.alias&&j.push(g.replace(l,d.aliasfor).replace(m,s.alias)),j.push(g.replace(l,d.path).replace(m,e.escape(e.path(s.hash)))),s.read&&j.push(g.replace(l,d.link).replace(m,'<a href="'+e.url(s.hash)+'" target="_blank">'+s.name+"</a>")),s.dim&&j.push(g.replace(l,d.dim).replace(m,s.dim)),j.push(g.replace(l,d.modify).replace(m,e.formatDate(s.date))),j.push(g.replace(l,d.perms).replace(m,e.formatPermissions(s))),j.push(g.replace(l,d.locked).replace(m,s.locked?d.yes:d.no))):(k=k.replace("{class}","elfinder-cwd-icon-group"),t=f.groupTitle.replace("{items}",d.items).replace("{num}",i),u=a.map(h,function(a){return a.mime=="directory"?1:null}).length,u?(j.push(g.replace(l,d.kind).replace(m,u==i?d.folders:d.folders+" "+u+", "+d.files+" "+(i-u))),j.push(g.replace(l,d.size).replace(m,f.spinner.replace("{text}",d.calc))),o=a.map(h,function(a){return a.hash})):(q=0,a.each(h,function(a,b){q+=b.size}),j.push(g.replace(l,d.kind).replace(m,d.files)),j.push(g.replace(l,d.size).replace(m,e.formatSize(q))))),k=k.replace("{title}",t).replace("{content}",j.join("")),p=e.dialog(k,n),r&&a("<img/>").load(function(){p.find(".elfinder-cwd-icon").css("background",'url("'+r+'") center center no-repeat')}).attr("src",r),o.length&&e.request({data:{cmd:"size",targets:o},preventDefault:!0}).fail(function(){p.find(".elfinder-spinner-mini").parent().text(d.unknown)}).done(function(a){var b=parseInt(a.size);p.find(".elfinder-spinner-mini").parent().text(b>=0?e.formatSize(b):d.unknown)})}},"use strict",elFinder.prototype.commands.mkdir=function(){this.disableOnSearch=!0,this.updateOnSelect=!1,this.mime="directory",this.prefix="untitle folder",this.exec=a.proxy(this.fm.res("mixin","make"),this),this.shortcuts=[{pattern:"ctrl+shift+n"}],this.getstate=function(){return this.fm.cwd().write?0:-1}},"use strict",elFinder.prototype.commands.mkfile=function(){this.disableOnSearch=!0,this.updateOnSelect=!1,this.mime="text/plain",this.prefix="untitle file.txt",this.exec=a.proxy(this.fm.res("mixin","make"),this),this.getstate=function(){return this.fm.cwd().write?0:-1}},"use strict",elFinder.prototype.commands.open=function(){this.alwaysEnabled=!0,this._handlers={dblclick:function(a){a.preventDefault(),this.exec()},"select enable disable reload":function(a){this.update(a.type=="disable"?-1:void 0)}},this.shortcuts=[{pattern:"ctrl+down numpad_enter"+(this.fm.OS!="mac"&&" enter")}],this.getstate=function(b){var b=this.files(b),c=b.length;return c==1?0:c?a.map(b,function(a){return a.mime=="directory"?null:a}).length==c?0:-1:-1},this.exec=function(b){var c=this.fm,d=c.errors(),e=a.Deferred().fail(function(a){a&&c.error(a)}),f=this.files(b),g=f.length,h,i,j,k;if(!g)return e.reject();if(g==1&&(h=f[0])&&h.mime=="directory")return h&&!h.read?e.reject([d.open,h.name,d.denied]):c.request({data:{cmd:"open",target:h.hash},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0});f=a.map(f,function(a){return a.mime!="directory"?a:null});if(g!=f.length)return e.reject();g=f.length;while(g--){h=f[g];if(!h.read)return e.reject([d.open,h.name,d.denied]);(i=c.url(h.hash))||(i=c.options.url,i=i+(i.indexOf("?")===-1?"?":"&")+(c.oldAPI?"cmd=open&current="+h.phash:"cmd=file")+"&target="+h.hash),k="",h.dim&&(j=h.dim.split("x"),k="width="+(parseInt(j[0])+20)+",height="+(parseInt(j[1])+20));if(!window.open(i,"_blank",k+",top=50,left=50,scrollbars=yes,resizable=yes"))return e.reject(d.popup)}return e.resolve(b)}},"use strict",elFinder.prototype.commands.paste=function(){this.disableOnSearch=!0,this.updateOnSelect=!1,this.handlers={changeclipboard:function(){this.update()}},this.shortcuts=[{pattern:"ctrl+v shift+insert"}],this.getstate=function(b){if(b){if(a.isArray(b)){if(b.length!=1)return-1;b=this.fm.file(b[0])}}else b=this.fm.cwd();return this.fm.clipboard().length&&b.mime=="directory"&&b.write?0:-1},this.exec=function(b){var c=this.fm,d=c.errors(),b=b?this.files(b)[0]:c.cwd(),e=c.clipboard(),f=e.length,g=f?e[0].cut:!1,h=d[g?"move":"copy"],i=[],j=[],k=a.Deferred().fail(function(a){a&&c.error(a)}),l=function(b){return b.length&&c._commands.duplicate?c.exec("duplicate",b):a.Deferred().resolve()},m=function(d){var e=a.Deferred(),f=[],h=function(b,c){var d=[],e=b.length;while(e--)a.inArray(b[e].name,c)!==-1&&d.unshift(e);return d},i=function(a){var b=f[a],g=d[b],h=a==f.length-1;!g||c.confirm({title:c.res("msg","move"),text:c.i18n([c.res("error","exists"),g.name,c.res("confirm","repl")]),all:!h,accept:{label:"yes",callback:function(b){!h&&!b?i(++a):k(d)}},reject:{label:"no",callback:function(b){var c;if(b){c=f.length;while(a<c--)d[f[c]].remove=!0}else d[f[a]].remove=!0;!h&&!b?i(++a):k(d)}},cancel:{label:"cancel",callback:function(){e.resolve()}}})},j=function(a){f=h(d,a),f.length?i(0):k(d)},k=function(d){var d=a.map(d,function(a){return a.remove?null:a}),f=d.length,h={},i=[],j;if(!f)return e.resolve();j=d[0].phash,d=a.map(d,function(a){return a.hash}),c.request({data:{cmd:"paste",dst:b.hash,targets:d,cut:g?1:0,src:j},notify:{type:g?"move":"copy",cnt:f}}).always(function(){c.unlockfiles({files:d})})};if(!d.length)return e.resolve();c.oldAPI?k(d):c.option("copyOverwrite")?b.hash==c.cwd().hash?j(a.map(c.files(),function(a){return a.phash==b.hash?a.name:null})):c.request({data:{cmd:"ls",target:b.hash},notify:{type:"preparecopy",cnt:1,hideCnt:!0},preventFail:!0}).always(function(a){j(a.list||[])}):k(d);return e},n;if(!f||!b||b.mime!="directory")return k.reject();if(!b.write)return k.reject([h,e[0].name,d.perm]);n=c.parents(b.hash),a.each(e,function(c,f){if(!f.read)return!k.reject([h,e[0].name,d.perm]);if(g&&f.locked)return!k.reject([d.locked,f.name]);if(a.inArray(f.hash,n)!==-1)return!k.reject([d.copyinself,f.name]);f.phash==b.hash?j.push(f.hash):i.push({hash:f.hash,phash:f.phash,name:f.name})});return a.when(l(j),m(i)).always(function(){g&&c.clipboard([])})}},"use strict",elFinder.prototype.commands.quicklook=function(){var b=this,c=b.fm,d=0,e=1,f=2,g=d,h=a.browser.mozilla||a.browser.opera?"keypress":"keydown",i="elfinder-quicklook-navbar-icon",j="elfinder-quicklook-fullscreen",k=function(b){a(document).trigger(a.Event(h,{keyCode:b,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))},l=function(a){return{opacity:0,width:20,height:c.view=="list"?1:20,top:a.offset().top+"px",left:a.offset().left+"px"}},m=function(){var b=a(window);return{opacity:1,width:o,height:p,top:parseInt(q.position().top+b.scrollTop()),left:parseInt((b.width()-o)/2)}},n=function(a){var b=document.createElement(a.substr(0,a.indexOf("/"))),c=b.canPlayType&&b.canPlayType(a);return c&&c!==""&&c!="no"},o,p,q,r,s=a('<div class="elfinder-quicklook-title"/>'),t=a("<div/>"),u=a('<div class="elfinder-quicklook-info"/>'),v=a('<div class="'+i+" "+i+'-fullscreen"/>').mousedown(function(d){var e=b.window,f=e.is("."+j),g="scroll."+c.namespace,h=a(window);d.stopPropagation(),f?(e.css(e.data("position")).unbind("mousemove"),h.unbind(g).trigger(b.resize).unbind(b.resize),w.unbind("mouseenter").unbind("mousemove")):(e.data("position",{left:e.css("left"),top:e.css("top"),width:e.width(),height:e.height()}).css({width:"100%",height:"100%"}),a(window).bind(g,function(){e.css({left:parseInt(a(window).scrollLeft())+"px",top:parseInt(a(window).scrollTop())+"px"})}).bind(b.resize,function(a){b.preview.trigger("changesize")}).trigger(g).trigger(b.resize),e.bind("mousemove",function(a){w.stop(!0,!0).show().delay(3e3).fadeOut("slow")}).mousemove(),w.mouseenter(function(){w.stop(!0,!0).show()}).mousemove(function(a){a.stopPropagation()})),w.attr("style","").draggable(f?"destroy":{}),e.toggleClass(j),a(this).toggleClass(i+"-fullscreen-off"),a.fn.resizable&&q.add(e).resizable(f?"enable":"disable").removeClass("ui-state-disabled")}),w=a('<div class="elfinder-quicklook-navbar"/>').append(a('<div class="'+i+" "+i+'-prev"/>').mousedown(function(){k(37)})).append(v).append(a('<div class="'+i+" "+i+'-next"/>').mousedown(function(){k(39)})).append('<div class="elfinder-quicklook-navbar-separator"/>').append(a('<div class="'+i+" "+i+'-close"/>').mousedown(function(){b.window.trigger("close")}));this.resize="resize."+c.namespace,this.info=a('<div class="elfinder-quicklook-info-wrapper"/>').append(t).append(u),this.preview=a('<div class="elfinder-quicklook-preview ui-helper-clearfix"/>').bind("change",function(a){b.info.attr("style","").hide(),t.removeAttr("class").css("background",""),u.html("")}).bind("update",function(c){var d=b.fm,e=b.preview,f=c.file,g='<div class="elfinder-quicklook-info-data">{value}</div>',h;f?(!f.read&&c.stopImmediatePropagation(),b.window.data("hash",f.hash),b.preview.unbind("changesize").trigger("change").children().remove(),s.html(d.escape(f.name)),u.html(g.replace(/\{value\}/,f.name)+g.replace(/\{value\}/,d.mime2kind(f))+(f.mime=="directory"?"":g.replace(/\{value\}/,d.formatSize(f.size)))+g.replace(/\{value\}/,d.i18n("Modified")+": "+d.formatDate(f.date))),t.addClass("elfinder-cwd-icon ui-corner-all "+d.mime2class(f.mime)),f.tmb&&a("<img/>").hide().appendTo(b.preview).load(function(){t.css("background",'url("'+h+'") center center no-repeat'),a(this).remove()}).attr("src",h=d.tmb(f.hash)),b.info.delay(100).fadeIn(10)):c.stopImmediatePropagation()}),this.window=a('<div class="ui-helper-reset ui-widget elfinder-quicklook" style="position:absolute"/>').click(function(a){a.stopPropagation()}).append(a('<div class="elfinder-quicklook-titlebar"/>').append(s).append(a('<span class="ui-icon ui-icon-circle-close"/>').mousedown(function(a){a.stopPropagation(),b.window.trigger("close")}))).append(this.preview.add(w)).append(b.info.hide()).draggable({handle:"div.elfinder-quicklook-titlebar"}).bind("open",function(a){var c=b.window,d=b.value,h;b.closed()&&d&&(h=r.find("#"+d.hash)).length&&(g=e,h.trigger("scrolltoview"),c.css(l(h)).show().animate(m(),550,function(){g=f,b.update(1,b.value)}))}).bind("close",function(a){var c=b.window,f=b.preview.trigger("change"),h=b.value,i=r.find("#"+c.data("hash")),k=function(){g=d,c.hide(),f.children().remove(),b.update(0,b.value)};b.opened()&&(g=e,c.is("."+j)&&v.mousedown(),i.length?c.animate(l(i),500,k):k())}),this.alwaysEnabled=!0,this.value=null,this.handlers={select:function(){this.update(void 0,this.fm.selectedFiles()[0])},error:function(){b.window.is(":visible")&&b.window.data("hash","").trigger("close")},"searchshow searchhide":function(){this.opened()&&this.window.trigger("close")}},this.shortcuts=[{pattern:"space"}],this.support={audio:{ogg:n('audio/ogg; codecs="vorbis"'),mp3:n("audio/mpeg;"),wav:n('audio/wav; codecs="1"'),m4a:n("audio/x-m4a;")||n("audio/aac;")},video:{ogg:n('video/ogg; codecs="theora"'),webm:n('video/webm; codecs="vp8, vorbis"'),mp4:n('video/mp4; codecs="avc1.42E01E"')||n('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')}},this.closed=function(){return g==d},this.opened=function(){return g==f},this.init=function(){var d=this.options,e=this.window,f=this.preview,g,h;o=d.width>0?parseInt(d.width):450,p=d.height>0?parseInt(d.height):300,c.one("load",function(){q=c.getUI(),r=c.getUI("cwd"),e.appendTo("body").zIndex(100+q.zIndex()),a(document).keydown(function(a){a.keyCode==27&&b.opened()&&e.trigger("close")}),a.fn.resizable&&e.resizable({handles:"se",minWidth:350,minHeight:120,resize:function(){f.trigger("changesize")}}),b.change(function(){b.opened()&&(b.value?f.trigger(a.Event("update",{file:b.value})):e.trigger("close"))}),a.each(c.commands.quicklook.plugins||[],function(a,c){typeof c=="function"&&new c(b)}),f.bind("update",function(){b.info.show()})})},this.getstate=function(){return this.fm.selected().length==1?g==f?1:0:-1},this.exec=function(){this.enabled()&&this.window.trigger(this.opened()?"close":"open")},this.hideinfo=function(){this.info.stop(!0).hide()}},elFinder.prototype.commands.quicklook.plugins=[function(b){var c=["image/jpeg","image/png","image/gif"],d=b.preview;a.each(navigator.mimeTypes,function(b,d){var e=d.type;e.indexOf("image/")===0&&a.inArray(e,c)&&c.push(e)}),d.bind("update",function(e){var f=e.file,g;a.inArray(f.mime,c)!==-1&&(e.stopImmediatePropagation(),g=a("<img/>").hide().appendTo(d).load(function(){setTimeout(function(){var a=(g.width()/g.height()).toFixed(2);d.bind("changesize",function(){var b=parseInt(d.width()),c=parseInt(d.height()),e,f;a<(b/c).toFixed(2)?(f=c,e=Math.floor(f*a)):(e=b,f=Math.floor(e/a)),g.width(e).height(f).css("margin-top",f<c?Math.floor((c-f)/2):0)}).trigger("changesize"),b.hideinfo(),g.fadeIn(100)},1)}).attr("src",b.fm.url(f.hash)))})},function(b){var c=["text/html","application/xhtml+xml"],d=b.preview,e=b.fm;d.bind("update",function(f){var g=f.file,h;a.inArray(g.mime,c)!==-1&&(f.stopImmediatePropagation(),d.one("change",function(){!h.isResolved()&&!h.isRejected()&&h.reject()}),h=e.request({data:{cmd:"get",target:g.hash,current:g.phash},preventDefault:!0}).done(function(c){b.hideinfo(),doc=a('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(d)[0].contentWindow.document,doc.open(),doc.write(c.content),doc.close()}))})},function(b){var c=b.fm,d=c.res("mimes","text"),e=b.preview;e.bind("update",function(f){var g=f.file,h=g.mime,i;if(h.indexOf("text/")===0||a.inArray(h,d)!==-1)f.stopImmediatePropagation(),e.one("change",function(){!i.isResolved()&&!i.isRejected()&&i.reject()}),i=c.request({data:{cmd:"get",target:g.hash},preventDefault:!0}).done(function(d){b.hideinfo(),a('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text">'+c.escape(d.content)+"</pre></div>").appendTo(e)})})},function(b){var c=b.fm,d="application/pdf",e=b.preview,f=!1;a.browser.safari&&navigator.platform.indexOf("Mac")!=-1||a.browser.msie?f=!0:a.each(navigator.plugins,function(b,c){a.each(c,function(a,b){if(b.type==d)return!(f=!0)})}),f&&e.bind("update",function(f){var g=f.file,h;g.mime==d&&(f.stopImmediatePropagation(),e.one("change",function(){h.unbind("load").remove()}),h=a('<iframe class="elfinder-quicklook-preview-pdf"/>').hide().appendTo(e).load(function(){b.hideinfo(),h.show()}).attr("src",c.url(g.hash)))})},function(b){var c=b.fm,d="application/x-shockwave-flash",e=b.preview,f=!1;a.each(navigator.plugins,function(b,c){a.each(c,function(a,b){if(b.type==d)return!(f=!0)})}),f&&e.bind("update",function(f){var g=f.file,h;g.mime==d&&(f.stopImmediatePropagation(),b.hideinfo(),e.append(h=a('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+c.url(g.hash)+'" quality="high" type="application/x-shockwave-flash" />')))})},function(b){var c=b.preview,d=!!b.options.autoplay,e={"audio/mpeg":"mp3","audio/mpeg3":"mp3","audio/mp3":"mp3","audio/x-mpeg3":"mp3","audio/x-mp3":"mp3","audio/x-wav":"wav","audio/wav":"wav","audio/x-m4a":"m4a","audio/aac":"m4a","audio/mp4":"m4a","audio/x-mp4":"m4a","audio/ogg":"ogg"},f;c.bind("update",function(g){var h=g.file,i=e[h.mime];b.support.audio[i]&&(g.stopImmediatePropagation(),f=a('<audio class="elfinder-quicklook-preview-audio" controls preload="auto" autobuffer><source src="'+b.fm.url(h.hash)+'" /></audio>').appendTo(c),d&&f[0].play())}).bind("change",function(){f&&f.parent().length&&(f[0].pause(),f.remove(),f=null)})},function(b){var c=b.preview,d=!!b.options.autoplay,e={"video/mp4":"mp4","video/x-m4v":"mp4","video/ogg":"ogg","application/ogg":"ogg","video/webm":"webm"},f;c.bind("update",function(g){var h=g.file,i=e[h.mime];b.support.video[i]&&(g.stopImmediatePropagation(),b.hideinfo(),f=a('<video class="elfinder-quicklook-preview-video" controls preload="auto" autobuffer><source src="'+b.fm.url(h.hash)+'" /></video>').appendTo(c),d&&f[0].play())}).bind("change",function(){f&&f.parent().length&&(f[0].pause(),f.remove(),f=null)})},function(b){var c=b.preview,d=[],e;a.each(navigator.plugins,function(b,c){a.each(c,function(a,b){(b.type.indexOf("audio/")===0||b.type.indexOf("video/")===0)&&d.push(b.type)})}),c.bind("update",function(f){var g=f.file,h=g.mime,i;a.inArray(g.mime,d)!==-1&&(f.stopImmediatePropagation(),(i=h.indexOf("video/")===0)&&b.hideinfo(),e=a('<embed src="'+b.fm.url(g.hash)+'" type="'+h+'" class="elfinder-quicklook-preview-'+(i?"video":"audio")+'"/>').appendTo(c))}).bind("change",function(){e&&e.parent().length&&(e.remove(),e=null)})}],elFinder.prototype.commands.reload=function(){this.alwaysEnabled=!0,this.updateOnSelect=!0,this.shortcuts=[{pattern:"ctrl+shift+r f5"}],this.getstate=function(){return 0},this.exec=function(){var a=this.fm,b=a.sync(),c=setTimeout(function(){a.notify({type:"reload",cnt:1,hideCnt:!0}),b.always(function(){a.notify({type:"reload",cnt:-1})})},a.notifyDelay);return b.always(function(){clearTimeout(c),a.trigger("reload")})}},"use strict",elFinder.prototype.commands.rename=function(){this.disableOnSearch=!0,this.shortcuts=[{pattern:"f2"+(this.fm.OS=="mac"&&" enter")}],this.getstate=function(){var a=this.fm.selectedFiles();return a.length==1&&a[0].phash&&!a[0].locked?0:-1},this.exec=function(){var b=this.fm,c=b.getUI("cwd"),d=b.selected(),e=d.length,f=b.errors(),g=b.file(d.shift()),h=".elfinder-cwd-filename",i=a.Deferred().fail(function(a){var d=j.parent(),e=b.escape(g.name);a&&b.error(a),d.length?(j.remove(),d.html(e)):c.find("#"+g.hash).find(h).html(e)}).always(function(){b.enable()}),j=a('<input type="text"/>').keydown(function(b){b.stopPropagation(),b.stopImmediatePropagation(),b.keyCode==a.ui.keyCode.ESCAPE?i.reject():b.keyCode==a.ui.keyCode.ENTER&&j.blur()}).mousedown(function(a){a.stopPropagation()}).blur(function(){var c=a.trim(j.val()),d=j.parent();if(d.length){if(c==g.name)return i.reject();if(!c)return i.reject(f.invName);if(b.fileByName(c,g.phash))return i.reject([f.exists,c]);d.html(b.escape(c)),b.lockfiles({files:[g.hash]}),b.request({data:{cmd:"rename",target:g.hash,name:c},notify:{type:"rename",cnt:1}}).fail(function(a){i.reject(),b.sync()}).done(function(a){i.resolve(a)}).always(function(){b.unlockfiles({files:[g.hash]})})}}),k=c.find("#"+g.hash).find(h).empty().append(j.val(g.name));if(!g||e>1||!k.length)return i.reject(f.invParams);if(g.locked)return i.reject([f.locked,g.name]);b.disable(),j.select().focus();return i}},"use strict",elFinder.prototype.commands.rm=function(){this.shortcuts=[{pattern:"delete ctrl+backspace"}],this.getstate=function(b){var c=this.fm;b=b||c.selected();return b.length&&a.map(b,function(a){var b=c.file(a);return b&&b.phash&&!b.locked?a:null}).length==b.length?0:-1},this.exec=function(b){var c=this,d=this.fm,e=d.errors(),f=a.Deferred().fail(function(a){a&&d.error(a)}),g=this.files(b),h=g.length,i=d.cwd().hash,j=!1;if(!h)return f.reject();a.each(g,function(a,b){if(!b.phash)return!f.reject([e.rm,b.name,e.denied]);if(b.locked)return!f.reject([d.errors.locked,b.name]);b.hash==i&&(j=d.root(b.hash))}),f.isRejected()||(g=this.hashes(b),d.confirm({title:c.title,text:d.res("confirm","rm"),accept:{label:c.title,callback:function(){d.lockfiles({files:g}),d.request({data:{cmd:"rm",targets:g},notify:{type:"rm",cnt:h},preventFail:!0}).fail(function(a){f.reject(a)}).done(function(a){f.done(a),j&&d.exec("open",j)}).always(function(){d.unlockfiles({files:g})})}},cancel:{label:"cancel",callback:function(){f.reject()}}}));return f}},"use strict",elFinder.prototype.commands.search=function(){this.title="Find files",this.options={ui:"searchbutton"},this.alwaysEnabled=!0,this.updateOnSelect=!1,this.getstate=function(){return 0},this.exec=function(b){var c=this.fm;if(typeof b=="string"&&b)return c.request({data:{cmd:"search",q:b},notify:{type:"search",cnt:1,hideCnt:!0}});c.getUI("toolbar").find("."+c.res("class","searchbtn")+" :text").focus();return a.Deferred().reject()}},"use strict",elFinder.prototype.commands.up=function(){this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+up"}],this.getstate=function(){return this.fm.cwd().phash?0:-1},this.exec=function(){return this.fm.cwd().phash?this.fm.exec("open",this.fm.cwd().phash):a.Deferred().reject()}},"use strict",elFinder.prototype.commands.upload=function(){var b=this.fm.res("class","hover"),c=function(b){var c="",d,e;if(!a.trim(b))return{error:[errors.response,errors.empty]};try{d=a.parseJSON(b)}catch(f){return{error:[errors.response,errors.json]}}if(!fm.validResponse("upload",d))return{error:[errors.response]};if(d.error){if(fm.newAPI)return{error:d.error};c=fm.i18n(d.error),a.each(d.errorData||[],function(a,b){c+=". "+fm.i18n(b)+": "+a}),d.error=null;if(!fm.validResponse("upload",d))return{error:c}}if(fm.newAPI)return fm.normalizeData("upload",d);e=fm.normalizeData("open",d),e=fm.diff(e.files),e.current=d.cwd.hash,e.warning=c;return e};this.disableOnSearch=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+u"}],this.getstate=function(){return this.fm.cwd().write?0:-1},this.exec=function(c){var d=this.fm,e=function(a){g.elfinderdialog("close"),d.upload(a).fail(function(a){f.reject(a)}).done(function(a){f.resolve(a)})},f,g,h,i,j;if(c&&(c.input||c.files))return d.upload(c);f=a.Deferred(),h=a('<input type="file" multiple="true"/>').change(function(){e({input:h[0]})}),i=a('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+d.i18n("Select files to upload")+"</span></div>").append(a("<form/>").append(h)).hover(function(){i.toggleClass("ui-state-hover")}),g=a('<div class="elfinder-upload-dialog-wrapper"/>').append(i),d.dragUpload&&(j=a('<div class="ui-corner-all elfinder-upload-dropbox">'+d.i18n("Drop files here")+"</div>").prependTo(g).after('<div class="elfinder-upload-dialog-or">'+d.i18n("or")+"</div>")[0],j.addEventListener("dragenter",function(c){c.stopPropagation(),c.preventDefault(),a(j).addClass(b)},!1),j.addEventListener("dragleave",function(c){c.stopPropagation(),c.preventDefault(),a(j).removeClass(b)},!1),j.addEventListener("dragover",function(a){a.stopPropagation(),a.preventDefault()},!1),j.addEventListener("drop",function(a){a.stopPropagation(),a.preventDefault(),e({files:a.dataTransfer.files})},!1)),d.dialog(g,{title:this.title,modal:!0,resizable:!1,destroyOnClose:!0});return f}},"use strict",elFinder.prototype.commands.view=function(){this.value=this.fm.storage("view"),this.alwaysEnabled=!0,this.updateOnSelect=!1,this.options={ui:"viewbutton"},this.getstate=function(){return 0},this.exec=function(){var a=this.fm.storage("view",this.value=="list"?"icons":"list");this.fm.viewchange(),this.update(void 0,a)}}})(jQuery)